<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Glossary of terms used within the Avishikta Type-A Community site." />
  <meta property="og:title" content="Glossary - Avishikta Type-A" />
  <meta property="og:description" content="Explore common community terms and their meanings." />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="theme-color" content="#000000" />
  <script src="layout-loader.js"></script>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <title>Glossary - Avishikta - I Type-A</title>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: linear-gradient(to right, #ffe0b2, #fff3e0); /* light orange to very light */
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      max-width: 900px;
      margin: 1rem auto 3rem;
      padding: 0 1rem;
      flex-grow: 1;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
      background: linear-gradient(45deg, #6ec1e4, #2980b9, #27ae60, #f39c12);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .last-updated {
      text-align: center;
      color: #2980b9;
      font-weight: bold;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    /* Search input */
    .search-wrapper {
      position: relative;
      max-width: 400px;
      margin: 0 auto 1rem;
    }

    #searchInput {
      width: 100%;
      padding: 0.5rem 2.5rem 0.5rem 0.8rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.4rem;
      color: #666;
      cursor: pointer;
      display: none;
    }

    .clear-btn:hover {
      color: #c0392b;
    }

    /* Sticky alphabet filter bar */
    .alphabet-filter {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.2rem;
      background: linear-gradient(90deg, #ffe0b2, #fff3e0); /* light orange gradient */
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* subtle shadow to lift it */
      padding: 0.5rem 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 30px;
      z-index: 100;
    }

    .alphabet-filter button {
      flex: 1 1 4%;
      min-width: 24px;
      padding: 0.4rem 0;
      font-size: 0.85rem;
      background-image: linear-gradient(135deg, #5dade2, #7d3c98);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
      user-select: none;
    }

    .alphabet-filter button:hover,
    .alphabet-filter button.active {
      background-color: #2980b9;
      background-image: none;
    }

    #showAllBtn {
      flex: 1 1 12%;
      min-width: 90px;
      background-color: #27ae60;
    }

    #showAllBtn:hover {
      background-color: #1e8449;
      background-image: none;
    }

    #sortToggleBtn {
      flex: 1 1 12%;
      min-width: 90px;
      background-color: #f39c12;
    }

    #sortToggleBtn:hover {
      background-color: #d68910;
      background-image: none;
    }

    ul.glossary-list {
      list-style: none;
      padding: 0;
      margin: 0 auto;
      max-width: 700px;
    }

    ul.glossary-list li {
      background: white;
      margin: 0.3rem 0;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
    }

    ul.glossary-list li strong {
      color: #34495e;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .dash {
      color: #999;
      font-weight: bold;
      margin: 0 0.4rem;
      user-select: none;
    }

    ul.glossary-list li p {
      background: #ffffff;
      color: #333;
      margin: 0;
      border-left: 4px solid #3498db;
      padding-left: 1rem;
      border-radius: 6px;
      flex-grow: 1;
    }

    /* Highlight for search matches */
    .highlight {
      background-color: #ffeb3b;
      color: #000;
      font-weight: 700;
      padding: 0 2px;
      border-radius: 3px;
    }

  #scrollTopBtn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background-color: #f39c12; /* Vibrant orange */
  color: white;
  border: none;
  padding: 0.5rem 0.6rem;
  font-size: 0.85rem;
  border-radius: 50%;
  cursor: pointer;
  display: none;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
  transition: background-color 0.3s, transform 0.2s;
  z-index: 1000;
}

#scrollTopBtn:hover {
  background-color: #d68910; /* Darker orange on hover */
  transform: scale(1.1);
}

    /* Did You Mean container */
    #didYouMeanContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.8rem; /* bigger gap between text and button */
  font-style: italic;
  color: #2980b9; /* a nice blue */
  font-weight: 600;
  font-size: 1.1rem;
}

#didYouMeanContainer span {
  color: #2980b9; /* same blue for the text */
}

#didYouMeanContainer button {
  margin-left: 0.3rem;
  padding: 0.3rem 0.7rem;
  font-style: normal;
  font-weight: 600;
  background: #3498db; /* bright blue button */
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s;
}

#didYouMeanContainer button:hover,
#didYouMeanContainer button:focus {
  background: #217dbb; /* darker blue on hover/focus */
  outline: none;
}

    @media (max-width: 600px) {
      .alphabet-filter {
        top: 65px; /* or adjust as needed */
       }
      .alphabet-filter button {
        flex: 1 1 10%;
        font-size: 0.85rem;
        min-width: 20px;
      }

      #showAllBtn {
        flex: 1 1 30%;
        min-width: 100px;
      }

      #sortToggleBtn {
        flex: 1 1 30%;
        min-width: 100px;
      }
      #scrollTopBtn {
    bottom: 80px; /* Move up a bit */
  }
}

</style>
</head>
<body>
  <main>
    <h1>Glossary of Terms</h1>
    <p class="last-updated" aria-live="polite"></p>

    <div class="search-wrapper">
      <input type="text" id="searchInput" placeholder="Search glossary..." aria-label="Search glossary" />
      <button class="clear-btn" id="clearSearchBtn" title="Clear search">Ã—</button>
    </div>

    <div class="alphabet-filter" role="toolbar" aria-label="Filter glossary by letter">
      <button id="showAllBtn" aria-pressed="true">Show All</button>
      <button id="sortToggleBtn" title="Toggle sort A-Z / Z-A" aria-pressed="true">Sort: A-Z</button>
      <button>A</button><button>B</button><button>C</button><button>D</button><button>E</button>
      <button>F</button><button>G</button><button>H</button><button>I</button><button>J</button>
      <button>K</button><button>L</button><button>M</button><button>N</button><button>O</button>
      <button>P</button><button>Q</button><button>R</button><button>S</button><button>T</button>
      <button>U</button><button>V</button><button>W</button><button>X</button><button>Y</button><button>Z</button>
    </div>

    <div id="didYouMeanContainer" aria-live="polite"></div>

    <ul class="glossary-list" id="glossaryList" aria-live="polite"></ul>
  </main>

  <button id="scrollTopBtn" title="Scroll to top" aria-label="Scroll to top">
  <i class="fas fa-chevron-up"></i>
  </button>

  <script>
    const glossaryData = [
      { term: 'Association', desc: 'A group of members in a residential community.' },
      { term: 'AGM', desc: 'Annual General Meeting held once in a year' },
      { term: 'EC', desc: 'Elected members managing the association.' },
      { term: 'Bylaws', desc: 'Rules that govern the association.' },
      { term: 'Common Area', desc: 'Shared spaces owned by the association.' },
      { term: 'Declaration', desc: 'Legal document establishing the association.' },
      { term: 'Dues', desc: 'Fees paid regularly by members.' },
      { term: 'Election', desc: 'Process of choosing board members.' },
      { term: 'General Body Meeting (GBM)', desc: 'Annual meeting of all members.' },
      { term: 'MMC', desc: 'Monthly Maintenance Charge to be deposited by each member to run the association.' },
      { term: 'President', desc: 'Head of the board of trustees.' },
      { term: 'Secretary', desc: 'Keeps records and minutes for the board.' },
      { term: 'Treasurer', desc: 'Manages association funds.' },
      { term: 'Quorum', desc: 'Minimum members required to conduct business.' },
      { term: 'Resolution', desc: 'Formal decision made by the board.' }
    ];

    const glossaryList = document.getElementById('glossaryList');
    const buttons = document.querySelectorAll('.alphabet-filter button:not(#sortToggleBtn)');
    const showAllBtn = document.getElementById('showAllBtn');
    const sortToggleBtn = document.getElementById('sortToggleBtn');
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearSearchBtn');
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    const lastUpdatedEl = document.querySelector('.last-updated');
    const didYouMeanContainer = document.getElementById('didYouMeanContainer');

    let currentSortAsc = true; // true = A-Z, false = Z-A

    // Show last updated date (today)
    function updateLastUpdated() {
      const today = new Date();
      lastUpdatedEl.textContent = `Last Updated: ${today.toLocaleDateString()}`;
    }
    updateLastUpdated();

    // Helper: Escape regex special chars for safe highlighting
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Helper: Highlight matched substrings inside a string (case insensitive)
    function highlightMatches(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // Levenshtein Distance for "Did You Mean" suggestions
    function levenshtein(a, b) {
      const matrix = Array.from({ length: b.length + 1 }, (_, i) => [i]);
      for (let j = 0; j <= a.length; j++) matrix[0][j] = j;

      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b.charAt(i - 1).toLowerCase() === a.charAt(j - 1).toLowerCase()) {
            matrix[i][j] = matrix[i - 1][j - 1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1,
              matrix[i][j - 1] + 1,
              matrix[i - 1][j] + 1
            );
          }
        }
      }
      return matrix[b.length][a.length];
    }

  // Find closest term to suggest
  function findClosestTerms(query) {
  if (query.length < 3) return [];

  const suggestions = [];
  const threshold = Math.min(3, query.length / 1.5);
  const lowerQuery = query.toLowerCase();

  glossaryData.forEach(item => {
    const termDist = levenshtein(lowerQuery, item.term.toLowerCase());
    const descDist = levenshtein(lowerQuery, item.desc.toLowerCase());

    if (termDist <= threshold) {
      suggestions.push({ text: item.term, distance: termDist });
    } else if (descDist <= threshold) {
      suggestions.push({ text: item.term, distance: descDist });
    }
  });

  // Remove duplicates, keep best distance for each term
  const uniqueSuggestions = [];
  const seen = new Map();

  suggestions.forEach(({ text, distance }) => {
    if (!seen.has(text) || distance < seen.get(text)) {
      seen.set(text, distance);
    }
  });

  seen.forEach((distance, text) => {
    uniqueSuggestions.push({ text, distance });
  });

  uniqueSuggestions.sort((a, b) => a.distance - b.distance);

  return uniqueSuggestions.slice(0, 3);
}


  function renderGlossary(filterLetter = null, overrideList = null, query = '') {
  glossaryList.innerHTML = '';

  // Only clear Did You Mean if no search query
  if (!query) {
    didYouMeanContainer.textContent = '';
  }

  let filtered = overrideList || glossaryData;

  if (filterLetter && filterLetter !== 'Show All') {
    filtered = filtered.filter(item => item.term.toUpperCase().startsWith(filterLetter));
  }

  if (query) {
    const lowerQuery = query.toLowerCase();
    filtered = filtered.filter(item =>
      item.term.toLowerCase().includes(lowerQuery) ||
      item.desc.toLowerCase().includes(lowerQuery)
    );

    if (filtered.length === 0) {
  const suggestions = findClosestTerms(query);
  
  if (suggestions.length > 0) {
    didYouMeanContainer.innerHTML = `Did you mean? ` + suggestions.map(s => 
      `<button class="didYouMeanBtn" data-suggestion="${s.text}" aria-label="Did you mean ${s.text}">${s.text}</button>`
    ).join(' ');

    document.querySelectorAll('.didYouMeanBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const suggestion = btn.dataset.suggestion;
        searchInput.value = suggestion;
        filterGlossary(null, suggestion);
        didYouMeanContainer.textContent = '';
      });
    });

    glossaryList.innerHTML = '';
    return;
  } else {
    didYouMeanContainer.innerHTML = '<span>No close matches found.</span>';
  glossaryList.innerHTML = '<li>No terms found.</li>';
  return;
  }
}

  }

  didYouMeanContainer.textContent = ''; // Clear "Did You Mean" if results found or no query

  filtered.sort((a, b) => {
    if (currentSortAsc) return a.term.localeCompare(b.term);
    return b.term.localeCompare(a.term);
  });

  if (filtered.length === 0) {
    glossaryList.innerHTML = '<li>No terms found.</li>';
    return;
  }

  filtered.forEach(item => {
    const li = document.createElement('li');
    const termHTML = highlightMatches(item.term, query);
    const descHTML = highlightMatches(item.desc, query);
    li.innerHTML = `<strong>${termHTML}</strong><span class="dash">â€”</span><p>${descHTML}</p>`;
    glossaryList.appendChild(li);
  });
}

    // Wrapper to filter glossary by letter and/or search query
    function filterGlossary(filterLetter = null, searchQuery = '') {
  buttons.forEach(btn => {
    if (filterLetter === 'Show All' && btn.id === 'showAllBtn') {
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');
    } else if (btn.textContent === filterLetter) {
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');
    } else {
      btn.classList.remove('active');
      btn.setAttribute('aria-pressed', 'false');
    }
  });

  renderGlossary(filterLetter, null, searchQuery);
}

    // Event: Letter filter click
    buttons.forEach(button => {
      button.addEventListener('click', () => {
        const letter = button.id === 'showAllBtn' ? 'Show All' : button.textContent;
        searchInput.value = '';
        clearBtn.style.display = 'none';
        didYouMeanContainer.textContent = '';
        filterGlossary(letter);
      });
    });

    // Event: Search input keyup
    searchInput.addEventListener('input', () => {
      const val = searchInput.value.trim();
      clearBtn.style.display = val ? 'inline' : 'none';
      filterGlossary(null, val);
    });

    // Event: Clear search button
    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      clearBtn.style.display = 'none';
      didYouMeanContainer.textContent = '';
      filterGlossary('Show All');
      searchInput.focus();
    });

function updateSortButtonLabel() {
  sortToggleBtn.textContent = currentSortAsc ? 'Sort: A-Z' : 'Sort: Z-A';
  sortToggleBtn.setAttribute('aria-pressed', currentSortAsc.toString());
}

    // Event: Sort toggle button
    sortToggleBtn.addEventListener('click', () => {
  // Toggle the sort order boolean
  currentSortAsc = !currentSortAsc;

  // Update button text based on the new sort order
  if (currentSortAsc) {
    sortToggleBtn.textContent = 'Sort: A-Z';
  } else {
    sortToggleBtn.textContent = 'Sort: Z-A';
  }

  // Update aria-pressed attribute for accessibility
  sortToggleBtn.setAttribute('aria-pressed', currentSortAsc.toString());

  // Re-render glossary with new sort order and current search query
  filterGlossary(null, searchInput.value.trim());
});

    // Scroll to top button logic
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollTopBtn.style.display = 'block';
      } else {
        scrollTopBtn.style.display = 'none';
      }
    });

    scrollTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      searchInput.focus();
    });

    // Initialize with all terms shown, sorted A-Z
    updateSortButtonLabel();
    filterGlossary('Show All');

  </script>
</body>
</html>
