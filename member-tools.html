<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="description" content="Official page of Avishikta - I Type - A RWA. Stay informed, get involved, and build a stronger association.">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
  <script src="layout-loader.js"></script>
  
  <title>Member Utilities - Housing Association</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f0f8ff, #d1eaff);
      --card-bg: #f3e5f5;
      --text: #4a148c;
      --primary: #0077cc;
      --shadow: rgba(0, 0, 0, 0.1);
      --radius: 8px;
      --font: 'Segoe UI', sans-serif;
    }

    body {
      font-family: var(--font);
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
    }

  .intro {
  padding: 0.5rem;  /* Reduced vertical padding */
  background: #f5f9ff;
  border-bottom: 2px solid #d0d7e3;
  margin-bottom: 1.5rem;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.intro h1 {
  font-size: 1.1rem;      /* Slightly smaller font */
  margin-bottom: 0.2rem;  /* Reduced gap */
  color: #2c3e50;
}

.intro p {
  margin-top: 0;
  font-size: 1rem;        /* Slightly smaller font */
  color: #555;
}

    .utility-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow);
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 10px;
    }

    /* Inputs and selects get full width and border */
input, select {
  width: 100%;
  box-sizing: border-box; /* include padding & border in width */
  padding: 10px;
  font-size: 1rem;
  margin: 5px 0 10px;
  border-radius: var(--radius);
  border: 1px solid #ccc;
}

/* Buttons get their own style, NOT full width */
button {
  padding: 10px 15px;
  font-size: 0.9rem;
  margin: 5px 0 10px;
  border-radius: var(--radius);
  background-color: var(--primary);
  color: #fff;
  border: none;
  cursor: pointer;
  width: auto; /* natural button width */
}

button:hover {
  background-color: #005fa3;
}

/* Result box style */
.result {
  background: #eef;
  padding: 10px;
  border-radius: var(--radius);
  margin-top: 10px;
  min-height: 20px;
}

    @media (max-width: 600px) {
  #healthTableView, #healthTableView tbody, #healthTableView tr, #healthTableView td {
    display: block;
    width: 100%;
  }
  #healthTableView tr {
    margin-bottom: 15px;
    border-bottom: 2px solid #eee;
  }
  #healthTableView td {
    text-align: right;
    padding-left: 50%;
    position: relative;
  }
  #healthTableView td::before {
    content: attr(data-label);
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 700;
    text-align: left;
  }
}


@media (max-width: 480px) {
  .card h2, .card h3 {
    font-size: 1rem;
  }

  button {
    font-size: 0.85rem;
    padding: 8px 12px;
  }

  input, select {
    font-size: 0.95rem;
  }
}

@media (max-width: 768px) {
  .utility-grid {
    grid-template-columns: 1fr;
  }

  .card {
    margin-bottom: 1rem;
  }
}

#goTopBtn {
  position: fixed;
  bottom: 40px;
  right: 20px;
  z-index: 999;
  width: 40px;
  height: 40px;
  background-color: var(--primary);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 1.0rem;
  cursor: pointer;
  display: none; /* Initially hidden */
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
  transition: opacity 0.3s ease-in-out;
}

#goTopBtn:hover {
  background-color: #005fa3;
}

#healthCardView .card {
  padding: 10px 15px;  /* reduce padding inside each card */
  margin-bottom: 10px; /* smaller gap between cards */
}

#healthCardView .card h2 {
  margin-bottom: 6px;  /* less space below the heading */
  font-size: 0.90rem;   /* slightly smaller heading if needed */
}

#healthCardView .card p {
  margin: 3px 0;       /* less vertical margin on paragraphs */
  line-height: 1.2;    /* tighter line height */
  font-size: 0.9rem;   /* smaller font for a compact look */
}

/* Keep thead font size as is */
  #healthTableView table thead th {
    font-size: 0.80rem; /* or whatever size you want */
  }
  
  /* Reduce tbody font size */
  #healthTableView table tbody td {
    font-size: 0.80rem; /* smaller than headings */
  }

#healthTableView input {
  font-size: 0.85rem;  /* Match surrounding table content */
  padding: 2px 4px;    /* Optional: tighten spacing */
  box-sizing: border-box;
}

.whats-new {
  background: #e8f5ff;
  border-left: 4px solid #2196F3;
  padding: 0.5rem 0.75rem;     /* Reduce vertical padding */
  border-radius: 4px;
  margin: 0.5rem 0;            /* Reduce vertical margin */
  font-size: 0.92rem;          /* Slightly smaller text overall */
  line-height: 1.3;            /* Tighter line spacing */
}

.whats-new h3 {
  margin: 0 0 0.4rem 0;        /* Reduce bottom margin */
  font-size: 1rem;             /* Slightly smaller heading */
}

.whats-new ul {
  margin: 0;
  padding-left: 1.2rem;        /* Keeps bullets aligned, compact */
}

.whats-new li {
  margin-bottom: 0.2rem;       /* Tighter space between items */
}

.dashboard-summary {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
  margin-bottom: 1rem;
  font-size: 0.75rem;
}

.dashboard-summary .ds-card {
  background: #fff;
  border-radius: var(--radius);
  padding: 0.7rem;
  flex: 1 1 150px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.ds-card h4 {
  margin: 0 0 0.3rem;
  font-size: 0.80rem;
}

.gamification-box {
  text-align: center;
  padding: 4px 10px;       /* simplified padding */
  border-radius: var(--radius);
  background: #fffbe6;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  font-size: 0.7rem;
  line-height: 1.0;
  position: relative;
  /* max-height: 50%; */   /* try removing */
}

.score-circle {
  width: 60px;
  height: 60px;
  margin: 0.5rem auto;
  border-radius: 50%;
  background: #4caf50;
  color: #fff;
  font-size: 1.2rem;
  line-height: 60px;
  font-weight: bold;
}

.badge {
  font-size: 0.75rem;
  padding: 3px 7px;
  border-radius: 12px;
  color: white;
  display: inline-block;
  font-weight: 500;
  line-height: 1;
}

.badge.ok {
  background-color: #4caf50; /* green */
}

.badge.alert {
  background-color: #f44336; /* red */
}

.badge.neutral {
  background-color: #9e9e9e; /* gray */
}

#healthChart {
  width: 350px !important;
  height: 250px !important;
}

#summaryStats {
  background: #f9f9f9;
  margin-top: 10px;
  border-top: 1px solid #ddd;
  font-size: 0.95rem;
  color: #333;
}

#summaryDashboard div {
  max-width: 300px;
  font-family: Arial, sans-serif;
}

#toggleSavedDataBtn {
    margin: 10px 0;
    font-size: 0.85rem;
</style>
</head>

<body>
  <div id="layout"></div>

  <main style="margin-top: 0px; padding: 0 1rem 1rem 1rem;">
    <section class="intro">
      <div class="whats-new">
  <h3>‚ú® What's New</h3>
  <ul>
    <li><strong>New:</strong> Daily Inspiration Recommender</li>
    <li><strong>Improved:</strong> Health Metrics now switchable between Table & Card view</li>
    <li><strong>Now Available:</strong> Mini Dashboard Summary for your key tools</li>
  </ul>
</div>

      <h1>üè° Member Utilities</h1>
      <p>Smart tools crafted with our housing association members in mind</p>
    </section>

<!-- Summary Dashboard -->
<div id="dashboardSummary" class="dashboard-summary" style="margin-top:20px;"></div>

<!-- Chart Container -->
<div id="chartContainer" style="max-width: 400px; margin-top: 20px; display: none;">
  <canvas id="healthChart" width="350" height="250" style="border:1px solid #ccc;"></canvas>
</div>

<!-- Gamification Box for score -->
<div class="gamification-box" style="margin-top:20px; font-size: 1.5rem;">
  <div>
    Health Score: <span class="score-circle" style="font-weight:bold;">--</span>
  </div>
  <div>
    Tier: <span class="badge">--</span>
  </div>
</div>

<!-- üè• Health Metrics Section -->
<!-- üîñ Common Health Metrics Heading with Buttons -->
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-top: 0.1rem;">

  <h2 style="margin: 0; font-size: 0.90rem;">üìä Common Health Metrics</h2>

  <div style="display: flex; gap: 5px; align-items: center; flex-wrap: wrap;">
    <!-- üîÅ Switch View Button -->
    <button id="toggleViewBtn"
      onclick="toggleHealthView()"
      style="
        padding: 5px 8px;
        font-size: 0.75rem;
        border-radius: 6px;
        background-color: #0077cc;
        color: white;
        border: none;
        cursor: pointer;">
      üîÑ Switch View to Card View
    </button>

    <!-- üîÑ Reset All Button -->
    <button id="resetAllBtn"
      onclick="resetAll()"
      title="Clear all health data & results"
      style="
        padding: 5px 8px;
        font-size: 0.75rem;
        border-radius: 6px;
        background-color: #cc3300;
        color: white;
        border: none;
        cursor: pointer;">
      ‚ôªÔ∏è Reset All
    </button>

    <!-- ‚úÖ Calculate Health Score Button -->
    <button id="calculateBtn"
      onclick="updateHealthStatus()"
      title="Evaluate current health inputs"
      style="
        padding: 5px 8px;
        font-size: 0.75rem;
        border-radius: 6px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;">
      ‚úÖ Calculate Health Score
    </button>
  </div>
</div>

<!-- üìä TABLE VIEW -->
<div class="card" id="healthTableView" style="grid-column: 1 / -1; padding: 0; overflow-x: auto;">
  <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
    <thead style="background-color: #0077cc; color: white;">
      <tr>
        <th style="padding: 10px; text-align: left;">Parameter</th>
        <th style="padding: 10px; text-align: left;">Standard</th>
        <th style="padding: 10px; text-align: left;">Alert Threshold</th>
        <th style="padding: 10px; text-align: left;">Tip</th>
        <th style="padding: 10px; text-align: left;">Input</th> <!-- NEW: for user input -->
        <th style="padding: 10px; text-align: left;">Status</th> <!-- NEW -->
      </tr>
    </thead>
    <tbody>
      <tr style="background: #e0f7fa;">
        <td>ü©∫ Blood Pressure</td>
        <td>120/80 mmHg</td>
        <td style="color: #ff9800;">&gt;130/90 mmHg</td>
        <td>Reduce salt, manage stress</td>
        <td><input type="text" class="user-input" data-param="bloodPressure" placeholder="e.g. 120/80" style="width: 100px;"></td>
        <td class="status-cell"></td>
        
      </tr>
      <tr style="background: #e8f5e9;">
        <td>üç¨ Blood Sugar (Fasting)</td>
        <td>80‚Äì100 mg/dL</td>
        <td style="color: #e53935;">&gt;110 mg/dL</td>
        <td>Cut sweets, test regularly</td>
        <td><input type="number" class="user-input" data-param="bloodSugarFasting" placeholder="e.g. 90" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #e6ffe6;">
        <td>üç≠ Blood Sugar (Post-Meal)</td>
        <td>&lt;140 mg/dL</td>
        <td style="color: #e53935;">&gt;180 mg/dL</td>
        <td>Avoid high-GI food, walk post meals</td>
        <td><input type="number" class="user-input" data-param="bloodSugarPostMeal" placeholder="e.g. 130" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #fff3e0;">
        <td>ü•ó Cholesterol (Total)</td>
        <td>&lt;200 mg/dL</td>
        <td style="color: #f44336;">&gt;240 mg/dL</td>
        <td>More fiber, less fried food</td>
        <td><input type="number" class="user-input" data-param="cholesterol" placeholder="e.g. 190" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #fce4ec;">
        <td>‚öñÔ∏è Body Mass Index (BMI)</td>
        <td>18.5‚Äì24.9</td>
        <td style="color: #ef6c00;">Under 18.5 or Over 25</td>
        <td>Track weight, stay active</td>
        <td><input type="number" step="0.1" class="user-input" data-param="bmi" placeholder="e.g. 22" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #ede7f6;">
        <td>üíì Resting Heart Rate</td>
        <td>60‚Äì100 bpm</td>
        <td style="color: #ff5722;">&lt;50 or &gt;100 bpm</td>
        <td>Hydrate, reduce caffeine</td>
        <td><input type="number" class="user-input" data-param="restingHeartRate" placeholder="e.g. 72" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #e1f5fe;">
        <td>üå¨Ô∏è SpO‚ÇÇ (Oxygen Level)</td>
        <td>95%‚Äì100%</td>
        <td style="color: #d32f2f;">Below 94%</td>
        <td>Seek help if persistently low</td>
        <td><input type="number" class="user-input" data-param="spo2" placeholder="e.g. 98" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #fff8e1;">
        <td>üí§ Sleep Duration</td>
        <td>7‚Äì9 hours/night</td>
        <td style="color: #f57f17;">Less than 6 hours/night</td>
        <td>Maintain regular schedule, avoid screens before bed</td>
        <td><input type="number" class="user-input" data-param="sleepDuration" placeholder="e.g. 8" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #f3e5f5;">
        <td>üìè Waist Circumference</td>
        <td>&lt;35 in (women), &lt;40 in (men)</td>
        <td style="color: #d32f2f;">Above these values</td>
        <td>Watch diet, increase activity</td>
        <td><input type="number" class="user-input" data-param="waistCircumference" placeholder="e.g. 36" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #fffde7;">
        <td>üßÇ Sodium</td>
        <td>135‚Äì145 mEq/L</td>
        <td style="color: #f57f17;">&lt;135 or &gt;145 mEq/L</td>
        <td>Balance salt intake, avoid processed foods</td>
        <td><input type="number" step="0.1" class="user-input" data-param="sodium" placeholder="e.g. 140" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #e0f2f1;">
        <td>ü•î Potassium</td>
        <td>3.5‚Äì5.0 mEq/L</td>
        <td style="color: #d32f2f;">&lt;3.5 or &gt;5.0 mEq/L</td>
        <td>Eat potassium-rich foods (bananas, spinach), monitor if on meds</td>
        <td><input type="number" step="0.1" class="user-input" data-param="potassium" placeholder="e.g. 4.5" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
      <tr style="background: #fff3e0;">
        <td>üß™ Creatinine</td>
        <td>0.6‚Äì1.3 mg/dL</td>
        <td style="color: #f44336;">&gt;1.3 mg/dL</td>
        <td>Stay hydrated, monitor kidney health</td>
        <td><input type="number" step="0.1" class="user-input" data-param="creatinine" placeholder="e.g. 1.0" style="width: 100px;"></td>
        <td class="status-cell"></td>
      </tr>
    </tbody>
  </table>

  <div id="summaryStats" style="margin: 10px 0; font-weight: 500;"></div>
  <button id="toggleSavedDataBtn" style="margin:10px 0;">Show Saved Data</button>
  <pre id="savedDataDisplay" style="background:#f0f0f0; padding:10px; max-height: 200px; overflow-y: auto; white-space: pre-wrap; border: 1px solid #ccc; display:none;">      </pre>

<div id="summaryDashboard" style="margin-top: 20px;"></div>

</div>

<!-- üì± CARD VIEW (Initially hidden) -->
<div id="healthCardView" style="display: none;">
  <div class="card" style="background: #e0f7fa;">
    <h2>ü©∫ Blood Pressure</h2>
    <p><strong>Standard:</strong> 120/80 mmHg</p>
    <p style="color: #ff9800;"><strong>Alert:</strong> >130/90 mmHg</p>
    <p>üí° Tip: Reduce salt, manage stress</p>
  </div>

  <div class="card" style="background: #e8f5e9;">
    <h2>üç¨ Blood Sugar (Fasting)</h2>
    <p><strong>Standard:</strong> 80‚Äì100 mg/dL</p>
    <p style="color: #e53935;"><strong>Alert:</strong> >110 mg/dL</p>
    <p>üí° Tip: Cut sweets, test regularly</p>
  </div>

  <div class="card" style="background: #e6ffe6;">
    <h2>üç≠ Blood Sugar (Post-Meal)</h2>
    <p><strong>Standard:</strong> &lt;140 mg/dL</p>
    <p style="color: #e53935;"><strong>Alert:</strong> >180 mg/dL</p>
    <p>üí° Tip: Avoid high-GI foods, walk after meals</p>
  </div>

  <div class="card" style="background: #fff3e0;">
    <h2>ü•ó Cholesterol (Total)</h2>
    <p><strong>Standard:</strong> &lt;200 mg/dL</p>
    <p style="color: #f44336;"><strong>Alert:</strong> >240 mg/dL</p>
    <p>üí° Tip: Avoid fried food, eat fiber</p>
  </div>

  <div class="card" style="background: #fce4ec;">
    <h2>‚öñÔ∏è Body Mass Index (BMI)</h2>
    <p><strong>Standard:</strong> 18.5‚Äì24.9</p>
    <p style="color: #ef6c00;"><strong>Alert:</strong> Under 18.5 or Over 25</p>
    <p>üí° Tip: Track weight, stay active</p>
  </div>

  <div class="card" style="background: #ede7f6;">
    <h2>üíì Resting Heart Rate</h2>
    <p><strong>Standard:</strong> 60‚Äì100 bpm</p>
    <p style="color: #ff5722;"><strong>Alert:</strong> Below 50 or Above 100</p>
    <p>üí° Tip: Hydrate, reduce caffeine</p>
  </div>

  <div class="card" style="background: #e1f5fe;">
    <h2>üå¨Ô∏è SpO‚ÇÇ (Oxygen Level)</h2>
    <p><strong>Standard:</strong> 95%‚Äì100%</p>
    <p style="color: #d32f2f;"><strong>Alert:</strong> Below 94%</p>
    <p>üí° Tip: Seek help if persistently low</p>
  </div>
  <div class="card" style="background: #fff8e1;">
  <h2>üí§ Sleep Duration</h2>
  <p><strong>Standard:</strong> 7‚Äì9 hours/night</p>
  <p style="color: #f57f17;"><strong>Alert:</strong> Less than 6 hours/night</p>
  <p>üí° Tip: Maintain regular schedule, avoid screens before bed</p>
</div>

<div class="card" style="background: #f3e5f5;">
  <h2>üìè Waist Circumference</h2>
  <p><strong>Standard:</strong> &lt;35 in (women), &lt;40 in (men)</p>
  <p style="color: #d32f2f;"><strong>Alert:</strong> Above these values</p>
  <p>üí° Tip: Watch diet, increase activity</p>
</div>
<div class="card" style="background: #fffde7;">
  <h2>üßÇ Sodium</h2>
  <p><strong>Standard:</strong> 135‚Äì145 mEq/L</p>
  <p style="color: #f57f17;"><strong>Alert:</strong> &lt;135 or &gt;145 mEq/L</p>
  <p>üí° Tip: Balance salt intake, avoid processed foods</p>
</div>

<div class="card" style="background: #e0f2f1;">
  <h2>ü•î Potassium</h2>
  <p><strong>Standard:</strong> 3.5‚Äì5.0 mEq/L</p>
  <p style="color: #d32f2f;"><strong>Alert:</strong> &lt;3.5 or &gt;5.0 mEq/L</p>
  <p>üí° Tip: Eat potassium-rich foods ((bananas, spinach), monitor if on meds</p>
</div>

<div class="card" style="background: #fff3e0;">
  <h2>üß™ Creatinine</h2>
  <p><strong>Standard:</strong> 0.6‚Äì1.3 mg/dL</p>
  <p style="color: #f44336;"><strong>Alert:</strong> &gt;1.3 mg/dL</p>
  <p>üí° Tip: Stay hydrated, monitor kidney health</p>
</div>

</div>

    <section class="utility-grid">
      <!-- üí∞ Tax Estimator (Upgraded) -->
  <div class="card">
  <h2>üí∞ Tax Estimator (India)</h2>

  <label>Annual Income (‚Çπ):</label>
  <<input type="number" min="0" id="incomeInput" placeholder="Enter total income" />

  <label>Deductions (‚Çπ):</label>
  <input type="number" min="0" id="deductionInput" placeholder="Enter 80C/80D deductions" />

  <label>Age Group:</label>
  <select id="ageGroup">
    <option value="below60">Below 60</option>
    <option value="senior">Senior (60-79)</option>
    <option value="super">Super Senior (80+)</option>
  </select>

  <button onclick="calculateTax()">Calculate Tax</button>
  <div class="result" id="taxResult"></div>
</div>

<!-- üìèüìà Unit Converter + INR to USD -->
<div class="card">
  <h2>üìè Conversions</h2>

  <!-- Unit Converter Section -->
  <h3 style="margin-bottom: 5px;">üßÆ Unit Converter</h3>
  <select id="unitType" onchange="updateUnitPlaceholders()">
    <option value="km-miles">KM ‚Üî Miles</option>
    <option value="kg-lbs">Kg ‚Üî Lbs</option>
    <option value="c-f">¬∞C ‚Üî ¬∞F</option>
  </select>
  <input type="number" min="0" id="unitInput" placeholder="Enter value" />
  <button onclick="convertUnit()">Convert</button>
  <div class="result" id="unitResult"></div>

  <hr style="margin: 15px 0;" />

  <!-- INR to USD Section -->
  <h3 style="margin-bottom: 5px;">üí± INR ‚Üí USD</h3>
  <input type="number" min="0" id="inrInput" placeholder="Enter INR" />
  <button onclick="convertINR()">Convert</button>
  <div class="result" id="inrResult"></div>
</div>

<!-- üõ†Ô∏è Issue Reporter -->
<div class="card">
  <h2>üõ†Ô∏è Report an Issue</h2>
  <label for="issueCategory">Category:</label>
  <select id="issueCategory">
    <option value="Water">üöø Water</option>
    <option value="Electricity">üí° Electricity</option>
    <option value="Cleanliness">üßπ Cleanliness</option>
    <option value="Security">üîí Security</option>
    <option value="Other">‚ùì Other</option>
  </select>

  <label for="issueText">Describe the issue:</label>
  <input type="text" id="issueText" placeholder="E.g., Leakage in basement near B-12" />

  <button onclick="submitIssue()">Submit Issue</button>

  <hr style="margin: 10px 0;" />

  <h3>üìù Reported Issues</h3>
  <ul id="issueList" style="padding-left: 1.1rem;"></ul>

</div>

<!-- üìÖüéÇ Age & Date Tools -->
<div class="card">
  <h2>üìÖ Date Tools</h2>

  <!-- Age Calculator -->
  <h3 style="margin-bottom: 5px;">üéÇ Age Calculator</h3>
  <input type="date" id="dobInput" />
  <button onclick="calculateAge()">Calculate Age</button>
  <div class="result" id="ageResult"></div>

  <hr style="margin: 15px 0;" />

  <!-- Date Difference -->
  <h3 style="margin-bottom: 5px;">üóìÔ∏è Date Difference</h3>
  <label>From:</label>
  <input type="date" id="date1Input" />
  <label>To:</label>
  <input type="date" id="date2Input" />
  <button onclick="calculateDateDiff()">Calculate</button>
  <div class="result" id="dateDiffResult"></div>
</div>


<!-- üí° Tip, Fact & Quote Generator -->
<!-- üí° Daily Inspiration Generator -->
<div class="card">
  <h2>üí° Daily Inspiration</h2>
  <div class="result" id="comboResult"></div>
  <button onclick="showNextItem()">üîÑ Next</button>

  <hr style="margin: 10px 0" />

  <h3>Submit a Tip:</h3>
  <input type="text" id="tipInput" placeholder="Write your own tip..." />
  <button onclick="submitTip()">Submit Tip</button>
</div>


<!-- üß† Society Trivia Game -->
<div class="card">
  <h2>üß† Society Trivia</h2>
  <div id="triviaQuestion">Click "Start" to begin!</div>
  <div id="triviaOptions"></div>
  <button onclick="startTrivia()">Start</button>
  <div class="result" id="triviaResult"></div>
</div>

</section>

<!-- ‚¨ÜÔ∏è Scroll to Top Button -->
<button id="goTopBtn" onclick="scrollToTop()" title="Go to top">‚¨ÜÔ∏è</button>

</main>

  <script>

    // üí∞ Tax Estimator
  function calculateTax() {
      const inc = parseFloat(document.getElementById('incomeInput').value) || 0;
      const ded = parseFloat(document.getElementById('deductionInput').value) || 0;
      const age = document.getElementById('ageGroup').value;
      if (inc < 0 || ded < 0) {
        alert('Enter non-negative amounts');
        return;
      }
      let slab = age === 'senior'? 300000 : age === 'super'? 500000 : 250000;
      const net = inc - ded;
      let tax = 0;
      if (net > slab && net <= 500000) tax = (net - slab) * 0.05;
      else if (net <= 1000000) tax = 12500 + (net - 500000) * 0.2;
      else if (net > 1000000) tax = 112500 + (net - 1000000) * 0.3;
      document.getElementById('taxResult').innerText = "‚Çπ" + (tax<0?0:tax.toFixed(2));
    }

    // Unit Convert
    function convertUnit() {
      const val = parseFloat(document.getElementById('unitInput').value);
      const type = document.getElementById('unitType').value;
      if (isNaN(val)) {
        document.getElementById('unitResult').innerText = 'Enter a valid number';
        return;
      }
      let res = type === 'km-miles'? `${val} km = ${(val*0.621371).toFixed(2)} miles`
        : type === 'kg-lbs'? `${val} kg = ${(val*2.20462).toFixed(2)} lbs`
        : `${val}¬∞C = ${(val*9/5+32).toFixed(2)}¬∞F`;
      document.getElementById('unitResult').innerText = res;
    }

    function updateUnitPlaceholders() {
      document.getElementById('unitInput').value = '';
      document.getElementById('unitResult').innerText = '';
    }

    // üéÇ Age Calculator
    function calculateAge() {
      const dobv = document.getElementById('dobInput').value;
      if (!dobv) {
        alert('Please choose a birth date');
        return;
      }
      const dob = new Date(dobv), now = new Date();
      let age = now.getFullYear() - dob.getFullYear();
      const m = now.getMonth() - dob.getMonth();
      if (m<0 || (m===0 && now.getDate()<dob.getDate())) age--;
      document.getElementById('ageResult').innerText = "Age: " + age + " years";
    }

    // Date Difference
    function calculateDateDiff() {
      const d1 = document.getElementById('date1Input').value;
      const d2 = document.getElementById('date2Input').value;
      const dt1 = d1? new Date(d1):NaN, dt2 = d2? new Date(d2):NaN;
      if (!d1 || !d2 || isNaN(dt1.getTime()) || isNaN(dt2.getTime())) {
        document.getElementById('dateDiffResult').innerText = 'Enter both valid dates';
        return;
      }
      const diff = Math.abs(dt2 - dt1);
      document.getElementById('dateDiffResult').innerText = Math.floor(diff/(1000*60*60*24)) + " days";
    }

  const defaultTips = [
  "Keep emergency contact numbers for security and maintenance easily accessible.",
  "Switch off common area lights during daytime to save energy.",
  "Regularly inspect and clean drainage systems to prevent waterlogging.",
  "Report any damaged sidewalks or community facilities promptly.",
  "Avoid parking in fire lanes to keep access clear for emergency vehicles.",
  "Participate in community clean-up drives to keep the neighborhood pleasant.",
  "Use water-efficient fixtures to reduce communal water consumption.",
  "Notify the committee about unauthorized construction or renovations."
];

const defaultFacts = [
  "Properly maintained green spaces can increase property values by up to 15%.",
  "Energy-efficient LED lighting can reduce electricity use by up to 80%.",
  "Timely maintenance of plumbing reduces water wastage and costly repairs.",
  "Community security initiatives have been shown to reduce theft by 30%.",
  "Regular pest control in shared spaces prevents widespread infestations.",
  "Installing rainwater harvesting systems can cut outdoor water use by 50%.",
  "Shared solar power systems are becoming popular in housing societies to lower electricity bills.",
  "Noise pollution can significantly impact residents‚Äô wellbeing and property values."
];


const defaultQuotes = [
  "‚ÄúAlone we can do so little; together we can do so much.‚Äù ‚Äî Helen Keller",
  "‚ÄúThe best way to find yourself is to lose yourself in the service of others.‚Äù ‚Äî Gandhi",
  "‚ÄúCommunity is much more than belonging to something; it‚Äôs about doing something together.‚Äù ‚Äî Unknown",
  "‚ÄúComing together is a beginning, staying together is progress, and working together is success.‚Äù ‚Äî Henry Ford",
  "‚ÄúA journey of a thousand miles begins with a single step.‚Äù ‚Äî Lao Tzu",
  "‚ÄúThe strength of the team is each individual member. The strength of each member is the team.‚Äù ‚Äî Phil Jackson",
  "‚ÄúIt takes a village to raise a child, and a community to build a home.‚Äù ‚Äî Unknown",
  "‚ÄúGreat things in business are never done by one person; they‚Äôre done by a team of people.‚Äù ‚Äî Steve Jobs",
  "‚ÄúIn every community, there is work to be done. In every nation, there are wounds to heal.‚Äù ‚Äî Marian Wright Edelman",
  "‚ÄúWe cannot live only for ourselves. A thousand fibers connect us with our fellow men.‚Äù ‚Äî Herman Melville",
  "‚ÄúShared joy is a double joy; shared sorrow is half a sorrow.‚Äù ‚Äî Swedish Proverb",
  "‚ÄúUnity is strength... when there is teamwork and collaboration, wonderful things can be achieved.‚Äù ‚Äî Mattie Stepanek"
];

const paramNames = {
  bloodPressure: "Blood Pressure",
  bloodSugarFasting: "Blood Sugar (Fasting)",
  bloodSugarPostMeal: "Blood Sugar (Post-Meal)",
  cholesterol: "Cholesterol",
  bmi: "Body Mass Index (BMI)",
  restingHeartRate: "Resting Heart Rate",
  spo2: "SpO‚ÇÇ (Oxygen Level)",
  sleepDuration: "Sleep Duration",
  waistCircumference: "Waist Circumference",
  sodium: "Sodium",
  potassium: "Potassium",
  creatinine: "Creatinine",
};


// Helper functions
function getLocalArray(key, fallback) {
  const stored = localStorage.getItem(key);
  return stored ? JSON.parse(stored) : fallback;
}

function getRandomFromArray(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// Arrays and labels for rotation
const comboArrays = [
  () => getLocalArray("customTips", defaultTips),
  () => defaultQuotes,
  () => defaultFacts,
];

const comboLabels = ["Tip", "Quote", "Fact"];

// Current combo index, saved in localStorage
let comboIndex = parseInt(localStorage.getItem("comboIndex")) || 0;

// Show next item in the rotation
function showNextItem() {
  comboIndex = (comboIndex + 1) % comboArrays.length;
  localStorage.setItem("comboIndex", comboIndex);

  const currentArray = comboArrays[comboIndex]();
  const label = comboLabels[comboIndex];
  const text = getRandomFromArray(currentArray);

  const display = document.getElementById("comboResult");
  display.innerText = `${label}: ${text}`;
}

// Submit new tip
function submitTip() {
  const newTip = document.getElementById("tipInput").value.trim();
  if (!newTip) return alert("Please enter a tip.");

  const tips = getLocalArray("customTips", defaultTips);
  tips.push(newTip);
  localStorage.setItem("customTips", JSON.stringify(tips));

  document.getElementById("tipInput").value = "";
  alert("Tip submitted!");

  // If currently showing Tip, refresh to show new tip
  if (comboIndex === 0) showNextItem();
}

// On page load, show last shown or a random one
window.addEventListener("DOMContentLoaded", () => {
  const currentArray = comboArrays[comboIndex]();
  const label = comboLabels[comboIndex];
  const text = getRandomFromArray(currentArray);

  const display = document.getElementById("comboResult");
  display.innerText = `${label}: ${text}`;
});

function convertINR() {
  const input = document.getElementById('inrInput');
  const val = parseFloat(input.value);

  if (isNaN(val) || val <= 0) {
    alert('Please enter a valid positive amount in INR');
    input.value = ''; // Clear the textbox
    return;
  }

  const out = document.getElementById('inrResult');
  out.innerText = '‚ö° Fetching...';

  fetch('https://open.er-api.com/v6/latest/INR')
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(j => {
      const rate = j.rates?.USD;
      if (!rate) throw 0;
      out.innerText = `‚Çπ${val} = $${(val * rate).toFixed(2)} (‚Çπ1 = $${rate.toFixed(4)})`;
    })
    .catch(_ => {
      out.innerText = '‚ö†Ô∏è Failed to fetch exchange rate';
    });
}

// üõ†Ô∏è Issue Reporter Logic
function submitIssue() {
  const text = document.getElementById("issueText").value.trim();
  const category = document.getElementById("issueCategory").value;
  if (!text) return alert("Please enter a description.");

  const issues = JSON.parse(localStorage.getItem("issues") || "[]");

  const newIssue = {
    text,
    category,
    date: new Date().toLocaleString()
  };

  issues.unshift(newIssue); // Add to top
  localStorage.setItem("issues", JSON.stringify(issues.slice(0, 10))); // Keep only last 10
  document.getElementById("issueText").value = "";
  loadIssues();
}

function loadIssues() {
  const issues = JSON.parse(localStorage.getItem("issues") || "[]");
  const list = document.getElementById("issueList");
  list.innerHTML = "";

  if (issues.length === 0) {
    list.innerHTML = "<li style='color: gray;'>No issues reported yet.</li>";
    return;
  }

  issues.forEach(issue => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>[${issue.category}]</strong> ${issue.text}<br/><small>${issue.date}</small>`;
    list.appendChild(li);
  });
}

// Load on startup
window.addEventListener("DOMContentLoaded", loadIssues);

// ‚¨ÜÔ∏è Scroll to Top Button Logic
const goTopBtn = document.getElementById("goTopBtn");

window.onscroll = function () {
  if (document.body.scrollTop > 150 || document.documentElement.scrollTop > 150) {
    goTopBtn.style.display = "block";
  } else {
    goTopBtn.style.display = "none";
  }
};

function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

const triviaQuestions = [
  {
    question: "How many flats are there in Type A?",
    options: ["24", "30", "64", "40"],
    answer: "64"
  },
  {
    question: "When was the society established?",
    options: ["2005", "2010", "2015", "2020"],
    answer: "2005"
  },
  {
    question: "How many total towers are there in our housing complex",
    options: ["10", "12", "13", "15"],
    answer: "13"
  },
  {
    question: "Which tower is the tallest?",
    options: ["Tower 1D", "Tower E", "Tower 2D", "Tower 3C"],
    answer: "Tower E"
  }
];

let currentTriviaIndex = 0;

function startTrivia() {
  if (currentTriviaIndex >= triviaQuestions.length) {
    document.getElementById("triviaQuestion").innerText = "üéâ You've completed the quiz!";
    document.getElementById("triviaOptions").innerHTML = "";
    return;
  }

  const currentQ = triviaQuestions[currentTriviaIndex];
  document.getElementById("triviaQuestion").innerText = currentQ.question;

  const optionsHTML = currentQ.options.map(option => {
    return `<button onclick="checkTriviaAnswer('${option}')">${option}</button>`;
  }).join("<br>");

  document.getElementById("triviaOptions").innerHTML = optionsHTML;
  document.getElementById("triviaResult").innerText = "";
}

function checkTriviaAnswer(selected) {
  const correct = triviaQuestions[currentTriviaIndex].answer;
  if (selected === correct) {
    document.getElementById("triviaResult").innerText = "‚úÖ Correct!";
  } else {
    document.getElementById("triviaResult").innerText = `‚ùå Incorrect. Correct answer: ${correct}`;
  }

  currentTriviaIndex++;
  setTimeout(startTrivia, 1500); // Move to next question after 1.5s
}

// üîÑ Toggle between Health Table and Card View
function toggleHealthView() {
  const table = document.getElementById("healthTableView");
  const cards = document.getElementById("healthCardView");
  const btn = document.getElementById("toggleViewBtn");

  const isTableVisible = table.style.display !== "none";

  table.style.display = isTableVisible ? "none" : "block";
  cards.style.display = isTableVisible ? "grid" : "none";

  // Optional: match grid style for card container
  if (isTableVisible) {
    cards.style.gridTemplateColumns = "repeat(auto-fit, minmax(300px, 1fr))";
    cards.style.gap = "20px";
  }

  btn.innerText = isTableVisible ? "üîÑ Switch to Table View" : "üîÑ Switch to Card View";
}

function resetAll() {
  if (!confirm("Are you sure you want to reset all data?")) return;

  // Clear all input fields (text, number, date)
  document.querySelectorAll('input').forEach(input => {
    if (['number', 'text', 'date'].includes(input.type)) {
      input.value = '';
    }
    input.style.borderColor = ''; // reset input border
  });

  // Reset status cells (badges)
  document.querySelectorAll('.status-cell').forEach(cell => {
    cell.innerHTML = '';
    cell.style.color = 'inherit';
  });

  // Reset select dropdowns (if any)
  document.querySelectorAll('select').forEach(select => {
    select.selectedIndex = 0;
  });

  // Clear all result boxes (if any)
  document.querySelectorAll('.result').forEach(result => {
    result.innerText = '';
  });

  // Clear dashboard score circle and badge
  const scoreCircle = document.querySelector('.score-circle');
  const badge = document.querySelector('.badge');
  if (scoreCircle) scoreCircle.innerText = '--';
  if (badge) badge.innerText = '';

  // Clear dashboard summary (mini stats)
  const summaryContainer = document.getElementById('dashboardSummary');
  if (summaryContainer) summaryContainer.innerHTML = '';

  // Clear the progress bars dashboard
  const progressContainer = document.getElementById('summaryDashboard');
  if (progressContainer) {
    progressContainer.innerHTML = '';
    progressContainer.style.display = 'none'; // optional: hide
  }

  // Clear health chart (if present)
  if (window.healthChartInstance) {
    window.healthChartInstance.destroy();
    window.healthChartInstance = null;
  }

  const chartContainer = document.getElementById('chartContainer');
  if (chartContainer) {
    chartContainer.style.display = 'none';
  }

  // Clear localStorage data used by this app
  localStorage.removeItem('issues');
  localStorage.removeItem('customTips');
  localStorage.removeItem('comboIndex');
  localStorage.removeItem('healthInputs'); // saved user inputs

  // Reload any other dynamic content (inspiration, tips, etc.)
  if (typeof loadIssues === 'function') loadIssues();
  if (typeof showNextItem === 'function') showNextItem();

  // Reset summary stats
const summaryDiv = document.getElementById('summaryStats');
if (summaryDiv) {
  summaryDiv.innerHTML =
    `üî¢ <strong>Entered:</strong> 0 &nbsp;&nbsp; ‚úÖ <strong>Normal:</strong> 0 &nbsp;&nbsp; ‚ö†Ô∏è <strong>Alerts:</strong> 0 &nbsp;&nbsp; üï≥Ô∏è <strong>Missing:</strong> 0`;
   summaryDiv.style.display = 'none'; // üîí hide the container
}
  alert("‚úÖ All data and results have been reset.");
}

</script>

<script>

document.addEventListener('DOMContentLoaded', () => {
  const saved = JSON.parse(localStorage.getItem('healthInputs') || '{}');
  for (const [param, val] of Object.entries(saved)) {
    const input = document.querySelector(`[data-param="${param}"]`);
    if (input) {
      input.value = val;
    }
  }

  // Immediately update health status after restoring
  updateHealthStatus();
});


const thresholds = {
  bloodPressure: val => {
    if (!val) return false;
    const parts = val.split('/').map(x => parseInt(x.trim()));
    if (parts.length !== 2 || parts.some(isNaN)) return false;
    const [sys, dia] = parts;
    return sys > 130 || dia > 90;
  },
  bloodSugarFasting: val => val && Number(val) > 110,
  bloodSugarPostMeal: val => val && Number(val) > 180,
  cholesterol: val => val && Number(val) > 240,
  bmi: val => val && (Number(val) < 18.5 || Number(val) > 25),
  restingHeartRate: val => val && (Number(val) < 50 || Number(val) > 100),
  spo2: val => val && Number(val) < 94,
  sleepDuration: val => val && Number(val) < 6,
  waistCircumference: val => val && Number(val) > 40,
  sodium: val => val && (Number(val) < 135 || Number(val) > 145),
  potassium: val => val && (Number(val) < 3.5 || Number(val) > 5.0),
  creatinine: val => val && Number(val) > 1.3,
};

const paramWeights = {
  bloodPressure: 10,
  bloodSugarFasting: 10,
  bloodSugarPostMeal: 10,
  cholesterol: 7,
  bmi: 6,
  restingHeartRate: 6,
  spo2: 8,
  sleepDuration: 5,
  waistCircumference: 5,
  sodium: 4,
  potassium: 4,
  creatinine: 5,
};

function updateHealthStatus() {
  const inputs = document.querySelectorAll('#healthTableView .user-input');

  // üõë Skip calculation if all inputs are empty
  const hasAnyInput = Array.from(inputs).some(input => input.value.trim() !== '');
  if (!hasAnyInput) {
    // Clear the score display
    const scoreCircle = document.querySelector('.score-circle');
    const badge = document.querySelector('.badge');
    if (scoreCircle) scoreCircle.innerText = '--';
    if (badge) badge.innerText = '--';
    return;
  }

  let totalWeight = 0;
  let deductedWeight = 0;
  const affectedParams = [];
  const paramValues = {};

  inputs.forEach(input => {
    const val = input.value.trim();
    const param = input.dataset.param;
    const statusCell = input.closest('tr').querySelector('.status-cell');

    const isAlert = thresholds[param] ? thresholds[param](val) : false;
    const weight = paramWeights[param] || 1;
    totalWeight += weight;

    paramValues[param] = val === '' ? null : val;

    if (val === '') {
      statusCell.innerHTML = '<span class="badge neutral">‚ö™ Not Entered</span>';
      statusCell.style.color = '#ff9800';
      input.style.borderColor = ''; // reset
    } else if (isAlert) {
      statusCell.innerHTML = '<span class="badge alert">‚ö†Ô∏è Alert</span>';
      statusCell.style.color = 'red';
      deductedWeight += weight;
      affectedParams.push(param);
      input.style.borderColor = 'red';
    } else {
      statusCell.innerHTML = '<span class="badge ok">‚úÖ Normal</span>';
      statusCell.style.color = 'green';
      input.style.borderColor = 'green';
    }
  });

  const score = totalWeight === 0 ? 0 : Math.round(((totalWeight - deductedWeight) / totalWeight) * 100);
  const tier = score >= 90 ? 'Gold' : score >= 75 ? 'Silver' : 'Bronze';

  const scoreCircle = document.querySelector('.score-circle');
  const badge = document.querySelector('.badge');
  if (scoreCircle) scoreCircle.innerText = score;
  if (badge) badge.innerText = `${tier} Tier`;

  renderDashboardSummaryFromTable(affectedParams);
  renderHealthChart(affectedParams, paramValues);

  // üîÑ Save all inputs to localStorage
localStorage.setItem('healthInputs', JSON.stringify(paramValues));
  
  let entered = 0, normal = 0, alert = 0, missing = 0;

inputs.forEach(input => {
  const val = input.value.trim();
  const statusCell = input.closest('tr').querySelector('.status-cell');

  if (val === '') {
    missing++;
  } else {
    entered++;
    if (statusCell.innerHTML.includes('alert')) {
      alert++;
    } else {
      normal++;
    }
  }
});

const summaryDiv = document.getElementById('summaryStats');
if (summaryDiv) {
  summaryDiv.innerHTML =
    `üî¢ <strong>Entered:</strong> ${entered} &nbsp;&nbsp; ‚úÖ <strong>Normal:</strong> ${normal} &nbsp;&nbsp; ‚ö†Ô∏è <strong>Alerts:</strong> ${alert} &nbsp;&nbsp; üï≥Ô∏è <strong>Missing:</strong> ${missing}`;
summaryDiv.style.display = 'block'; // üëÅÔ∏è make it visible again
}

function updateSummaryDashboard(paramValues, affectedParams) {
  const container = document.getElementById('summaryDashboard');
  container.innerHTML = ''; // clear previous summary

  Object.keys(paramValues).forEach(param => {
    // Skip missing inputs entirely
    if (paramValues[param] === null || paramValues[param] === '') return;

    let score = 100;
    if (affectedParams.includes(param)) score = 30;  // alert = low score

    // Create container for one param summary
    const paramDiv = document.createElement('div');
    paramDiv.style.marginBottom = '12px';

    // Label
    const label = document.createElement('div');
    label.textContent = paramNames[param] || (param.charAt(0).toUpperCase() + param.slice(1));
    label.style.marginBottom = '4px';
    paramDiv.appendChild(label);

    // Progress bar container
    const progressContainer = document.createElement('div');
    progressContainer.style.background = '#ddd';
    progressContainer.style.borderRadius = '8px';
    progressContainer.style.width = '100%';
    progressContainer.style.height = '20px';
    progressContainer.style.overflow = 'hidden';

    // Progress bar itself
    const progressBar = document.createElement('div');
    progressBar.style.width = score + '%';
    progressBar.style.height = '100%';
    progressBar.style.borderRadius = '8px';

    if (score >= 90) {
      progressBar.style.backgroundColor = 'green';
    } else if (score >= 60) {
      progressBar.style.backgroundColor = 'orange';
    } else {
      progressBar.style.backgroundColor = 'red';
    }

    progressContainer.appendChild(progressBar);
    paramDiv.appendChild(progressContainer);

    container.appendChild(paramDiv);
  });
}

updateSummaryDashboard(paramValues, affectedParams);

}

function renderDashboardSummaryFromTable(affected = []) {
  const summaryContainer = document.getElementById('dashboardSummary');
  if (!summaryContainer) return;
  summaryContainer.innerHTML = '';

  const tableRows = document.querySelectorAll('#healthTableView tbody tr');

  tableRows.forEach(row => {
    const input = row.querySelector('input.user-input');
    const param = input?.dataset.param || '';
    const parameter = row.querySelectorAll('td')[0]?.innerText || 'Unknown';
    const statusCell = row.querySelector('.status-cell');
    const statusText = statusCell ? statusCell.innerText : 'Status Unknown';
    const statusColor = statusCell ? statusCell.style.color : 'inherit';

    const dsCard = document.createElement('div');
    dsCard.className = 'ds-card';
    dsCard.style.border = affected.includes(param) ? '2px solid red' : '1px solid #ccc';
    dsCard.style.padding = '8px';
    dsCard.style.marginBottom = '8px';
    dsCard.style.borderRadius = '4px';
    dsCard.innerHTML = `
      <h4>${parameter}</h4>
      <p style="color: ${statusColor}; margin: 0;">${statusText}</p>
    `;
    summaryContainer.appendChild(dsCard);
  });
}

function renderHealthChart(affectedParams, paramValues) {
  const chartContainer = document.getElementById('chartContainer');
  const canvas = document.getElementById('healthChart');
  const ctx = canvas.getContext('2d');

  const labels = Object.keys(paramValues).filter(param => paramValues[param] !== null && paramValues[param] !== '');
  if (labels.length === 0) {
    chartContainer.style.display = 'none';
    return;
  }
  chartContainer.style.display = 'block';
  canvas.height = labels.length * 10; // Adjust this number as needed

  const data = labels.map(param => {
    const val = paramValues[param];
    if (typeof val === 'string' && val.includes('/')) {
      const parts = val.split('/').map(x => parseInt(x.trim()));
      return parts[0] || 0;
    }
    return Number(val) || 0;
  });

  const backgroundColors = labels.map(param =>
    affectedParams.includes(param)
      ? 'rgba(255, 99, 132, 0.8)'
      : 'rgba(75, 192, 192, 0.8)'
  );

  if (window.healthChartInstance) window.healthChartInstance.destroy();

  // Set canvas height so each bar + label has enough space ‚Äî 30px per bar is safe
  canvas.height = labels.length * 30;

  window.healthChartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Input Values',
        data,
        backgroundColor: backgroundColors,
        barThickness: 12,  // reasonable bar thickness
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,      // make chart responsive inside fixed canvas height
      maintainAspectRatio: false,
      scales: {
        x: {
          grid: {
           display: false  // no vertical grid lines
          },
          beginAtZero: true,
          ticks: { precision: 0 },
          max: Math.max(...data) * 1.2 || 100,
        },
        y: {
          grid: {
           display: false  // no vertical grid lines
          },
          ticks: {
            font: { size: 14 },  // slightly bigger font for clarity
            autoSkip: false,     // show all labels
          },
          categoryPercentage: 0.95,  // bigger category space
          barPercentage: 0.95,       // reasonable bar thickness inside category
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: context => `${context.parsed.x}`
          }
        }
      }
    }
  });
}

const toggleBtn = document.getElementById('toggleSavedDataBtn');
const displayArea = document.getElementById('savedDataDisplay');

toggleBtn.addEventListener('click', () => {
  if (displayArea.style.display === 'none' || displayArea.style.display === '') {
    // Show saved data
    const savedData = localStorage.getItem('healthInputs');
    if (savedData) {
      try {
        const obj = JSON.parse(savedData);
        displayArea.textContent = JSON.stringify(obj, null, 2);
      } catch (e) {
        displayArea.textContent = "Error parsing saved data.";
      }
    } else {
      displayArea.textContent = "No saved data found.";
    }
    displayArea.style.display = 'block';
    toggleBtn.textContent = 'Hide Saved Data';
  } else {
    // Hide saved data
    displayArea.style.display = 'none';
    toggleBtn.textContent = 'Show Saved Data';
  }
});

window.addEventListener('DOMContentLoaded', () => {
  // Clear all inputs in the healthTableView on page load
  document.querySelectorAll('#healthTableView .user-input').forEach(input => {
    input.value = '';
    input.style.borderColor = '';
  });

  // Clear stored health inputs from localStorage
  localStorage.removeItem('healthInputs');

  // Reset score display
  const scoreCircle = document.querySelector('.score-circle');
  const badge = document.querySelector('.badge');
  if (scoreCircle) scoreCircle.innerText = '--';
  if (badge) badge.innerText = '--';

  // Reset and hide summary stats container
  const summaryDiv = document.getElementById('summaryStats');
  if (summaryDiv) {
    summaryDiv.innerHTML = '';
    summaryDiv.style.display = 'none';
  }
});

</script>

</body>
</html>
