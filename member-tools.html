<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="description" content="Official page of Avishikta - I Type - A RWA. Stay informed, get involved, and build a stronger association.">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
  <script src="layout-loader.js"></script>
  
  <title>Member Utilities - Housing Association</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f0f8ff, #d1eaff);
      --card-bg: #f3e5f5;
      --text: #4a148c;
      --primary: #0077cc;
      --shadow: rgba(0, 0, 0, 0.1);
      --radius: 8px;
      --font: 'Segoe UI', sans-serif;
    }

    body {
      font-family: var(--font);
      background: var(--bg);
      margin: 0;
      padding: 0;
      color: var(--text);
    }

  .intro {
  padding: 0.5rem 0;  /* Reduced vertical padding */
  background: #f5f9ff;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.intro h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
  color: #2c3e50;
}
.intro ul {
  margin: 0;
  padding-left: 1.2rem;
  line-height: 1.2;
}

.intro li {
  margin-bottom: 0.3rem;
  font-size: 0.85rem;
}
#layout { background: rgba(255, 0, 0, 0.1); }
main { background: rgba(255, 165, 0, 0.1); }
.intro { background: rgba(0, 0, 255, 0.1); }

    .utility-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px var(--shadow);
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 10px;
    }

    /* Inputs and selects get full width and border */
input, select {
  width: 100%;
  box-sizing: border-box; /* include padding & border in width */
  padding: 10px;
  font-size: 1rem;
  margin: 5px 0 10px;
  border-radius: var(--radius);
  border: 1px solid #ccc;
}

/* Buttons get their own style, NOT full width */
button {
  padding: 10px 15px;
  font-size: 0.9rem;
  margin: 5px 0 10px;
  border-radius: var(--radius);
  background-color: var(--primary);
  color: #fff;
  border: none;
  cursor: pointer;
  width: auto; /* natural button width */
}

button:hover {
  background-color: #005fa3;
}

/* Result box style */
.result {
  background: #eef;
  padding: 10px;
  border-radius: var(--radius);
  margin-top: 10px;
  min-height: 20px;
}

    @media (max-width: 600px) {
  #healthTableView, #healthTableView tbody, #healthTableView tr, #healthTableView td {
    display: block;
    width: 100%;
  }
  #healthTableView tr {
    margin-bottom: 15px;
    border-bottom: 2px solid #eee;
  }
  #healthTableView td {
    text-align: right;
    padding-left: 50%;
    position: relative;
  }
  #healthTableView td::before {
    content: attr(data-label);
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 700;
    text-align: left;
  }
}

@media (max-width: 480px) {
  .card h2, .card h3 {
    font-size: 0.85rem;
  }

  button {
    font-size: 0.85rem;
    padding: 8px 12px;
  }

  input, select {
    font-size: 0.85rem;
  }
}

@media (max-width: 768px) {
  .utility-grid {
    grid-template-columns: 1fr;
  }

  .card {
    margin-bottom: 1rem;
  }
}

#goTopBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 999;
  width: 30px;
  height: 30px;
  background-color: var(--primary);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 0.85rem;
  cursor: pointer;
  display: none; /* <- This is the key to fix alignment */
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
  transition: opacity 0.3s ease-in-out;
  padding: 0; /* ensure no padding offsets text */
  line-height: 1; /* avoid any vertical misalignment */
}

#goTopBtn:hover {
  background-color: #005fa3;
}

#healthCardView .card {
  padding: 10px 15px;  /* reduce padding inside each card */
  margin-bottom: 10px; /* smaller gap between cards */
}

#healthCardView .card h2 {
  margin-bottom: 6px;  /* less space below the heading */
  font-size: 0.90rem;   /* slightly smaller heading if needed */
}

#healthCardView .card p {
  margin: 3px 0;       /* less vertical margin on paragraphs */
  line-height: 1.2;    /* tighter line height */
  font-size: 0.9rem;   /* smaller font for a compact look */
}

/* Keep thead font size as is */
  #healthTableView table thead th {
    font-size: 0.80rem; /* or whatever size you want */
  }
  
  /* Reduce tbody font size */
  #healthTableView table tbody td {
    font-size: 0.80rem; /* smaller than headings */
  }

#healthTableView input {
  font-size: 0.85rem;  /* Match surrounding table content */
  padding: 2px 4px;    /* Optional: tighten spacing */
  box-sizing: border-box;
}

.whats-new {
  background: #e8f5ff;
  border-left: 4px solid #2196F3;
  padding: 0.5rem 0.75rem;     /* Reduce vertical padding */
  border-radius: 4px;
  margin: 0.5rem 0;            /* Reduce vertical margin */
  font-size: 0.92rem;          /* Slightly smaller text overall */
  line-height: 1.3;            /* Tighter line spacing */
}

.whats-new h3 {
  margin: 0 0 0.4rem 0;        /* Reduce bottom margin */
  font-size: 1rem;             /* Slightly smaller heading */
}

.whats-new ul {
  margin: 0;
  padding-left: 1.2rem;        /* Keeps bullets aligned, compact */
}

.whats-new li {
  margin-bottom: 0.2rem;       /* Tighter space between items */
}

.dashboard-summary {
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
  margin-bottom: 1rem;
  font-size: 0.75rem;
}

.dashboard-summary .ds-card {
  background: #fff;
  border-radius: var(--radius);
  padding: 0.7rem;
  flex: 1 1 150px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.ds-card h4 {
  margin: 0 0 0.3rem;
  font-size: 0.80rem;
}

.gamification-box {
  text-align: center;
  padding: 2px 8px;       /* simplified padding */
  border-radius: var(--radius);
  background: #fffbe6;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  font-size: 0.7rem;
  line-height: 0.9;
  position: relative;
  /* max-height: 50%; */   /* try removing */
}

.score-circle {
  display: inline-block;
  width: 60px;       /* smaller width */
  height: 60px;      /* smaller height */
  line-height: 60px; /* vertically center text */
  border-radius: 50%;
  text-align: center;
  font-weight: bold;
  font-size: 1.4rem; /* adjust font size as needed */
  color: black;      /* default text color */
  background-color: #eee; /* default bg color */
  transition: background-color 0.3s ease, color 0.3s ease;
  user-select: none;
  margin: 0 auto;   /* center horizontally if block */
}


.badge {
  font-size: 0.75rem;
  padding: 3px 7px;
  border-radius: 12px;
  color: white;
  display: inline-block;
  font-weight: 500;
  line-height: 1;
}

.badge.ok {
  background-color: #4caf50; /* green */
}

.badge.alert {
  background-color: #f44336; /* red */
}

.badge.neutral {
  background-color: #9e9e9e; /* gray */
}

#healthChart {
  width: 350px !important;
  height: 250px !important;
}

#summaryStats {
  background: #f9f9f9;
  margin-top: 10px;
  border-top: 1px solid #ddd;
  font-size: 0.95rem;
  color: #333;
}

#summaryDashboard div {
  max-width: 300px;
  font-family: Arial, sans-serif;
}

#toggleSavedDataBtn {
    margin: 10px 0;
    font-size: 0.85rem;
}

@media (max-width: 600px) {
  /* Make table container scrollable if needed */
  #healthTableView {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Make table elements block to stack for mobile */
  #healthTableView table,
  #healthTableView thead,
  #healthTableView tbody,
  #healthTableView th,
  #healthTableView td,
  #healthTableView tr {
    display: block;
    width: 100%;
  }

  /* Hide thead rows (headings) on mobile */
  #healthTableView thead tr {
    display: none;
  }

  /* Style tbody rows */
  #healthTableView tbody tr {
    border: 1px solid #ccc;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 5px;
    min-height: 50px; /* Increase height for better spacing */
  }

  /* Style each td with label and value inline */
  #healthTableView tbody td {
    position: relative;
    padding-left: 110px; /* space for label */
    padding-top: 3px;
    padding-bottom: 3px;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Add the data-label content before each cell */
  #healthTableView tbody td::before {
    content: attr(data-label);
    font-weight: 600;
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    white-space: nowrap;
  }

  /* Inputs should be full width and fit nicely */
  #healthTableView tbody td input.user-input {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }

  /* Status cell specific padding and wrapping */
  #healthTableView tbody td.status-cell {
    white-space: normal;
    padding-top: 12px;
    padding-bottom: 12px;
  }
}
h3 {
  font-size: 0.95rem; /* or any size you prefer, e.g., 0.9rem or 14px */
  margin-bottom: 5px; /* keep your existing margin */
}

@media screen and (max-width: 480px) {
  .mobile-section {
    padding: 10px;
    font-size: 0.85rem;
  }

  #cwe_historySection button,
  #estimatorSection button {
    font-size: 0.85rem;
    padding: 10px;
  }
}
.filter-btn {
  padding: 6px 14px;       /* a bit wider for emoji + text */
  border-radius: 9999px;   /* pill shape */
  border: none;
  background-color: #e0f3ff;  /* light blue */
  color: blue;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.2s ease;
  border: 1px solid #b3d7f5;
  display: inline-flex;
  align-items: center;
  gap: 6px;                /* space between emoji and text */
}

.filter-btn:hover {
  background-color: #cce7ff; /* slightly darker on hover */
}

.filter-btn.active {
  background-color: #007acc; /* active bold blue */
  color: white;
  font-weight: bold;
}
body.member-tools header#page-header {
  min-height: 32px;
  max-height: 32px;
  padding: 0.1rem 0.4rem !important;
  font-size: 0.65rem !important;
  line-height: 1 !important;
  overflow: hidden;

  display: flex;
  align-items: center;
  justify-content: space-between;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #2a72d8, #feb47b);
  color: #fff;
  font-weight: 600;
  user-select: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  flex-wrap: nowrap;
  padding-left: 0.5rem;
  padding-right: 0.5rem;
  gap: 0.5rem;
  position: fixed;
  z-index: 9999;
}

/* Make header-text horizontally centered without messing vertical alignment */
body.member-tools header#page-header .header-text {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 50%; /* reduce width to avoid overlap */
  font-size: 0.65rem;
  line-height: 1;
  pointer-events: none;
  user-select: none;
  top: 50%;
  transform: translate(-50%, -50%); /* perfectly vertical & horizontal center */
  z-index: 1;
}

/* Keep hamburger and collapse toggle normally positioned and vertically centered */
body.member-tools header#page-header #nav-collapse-toggle {
  position: relative;
  margin-top: 35px; /* Push down by 4 pixels */
  z-index: 10;
  display: flex;
  align-items: center;
  height: 25px; /* same as header height */
}

/* Right side buttons container */
body.member-tools header#page-header .header-actions {
  position: relative;
  z-index: 10;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

/* Individual buttons on right */
body.member-tools header#page-header .header-actions a,
body.member-tools header#page-header .header-actions button {
  padding: 0.05rem 0.25rem;
  margin: 0;
  font-size: 0.65rem;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 24px;
}

/* On mobile, ensure header-text max-width is smaller to avoid overlap */
@media (max-width: 768px) {
  body.member-tools header#page-header .header-text {
    max-width: 40%;
  }
}

</style>
</head>

<body class="member-tools">
  <div id="layout"></div>

  <main>
  <section class="intro">
  <h3>🏡 Member Utilities</h3>
  <ul>
    <li>Smart tools crafted with our housing association members in mind</li>
    <li><strong>New:</strong> Daily Inspiration Recommender</li>
    <li><strong>Improved:</strong> Health Metrics now switchable between Table & Card view</li>
    <li><strong>Now Available:</strong> Mini Dashboard Summary for your key tools</li>
  </ul>
</section>

<div id="summaryFilterContainer" style="display: none; margin-bottom: 12px; gap: 10px; flex-wrap: wrap;">
  <button class="filter-btn" data-filter="all" onclick="renderDashboardSummaryFromTable()" style="background:#ccc;">🌈 Show All</button>
  <button class="filter-btn" data-filter="alert" onclick="renderDashboardSummaryFromTable()">⚠️ Alerts</button>
  <button class="filter-btn" data-filter="normal" onclick="renderDashboardSummaryFromTable()">✅ Normal</button>
  <button class="filter-btn" data-filter="neutral" onclick="renderDashboardSummaryFromTable()">⚪ Not Entered</button>
</div>

<!-- Summary Dashboard -->
<div id="dashboardSummary" class="dashboard-summary" style="margin-top:20px;"></div>

<!-- Chart Container -->
<div id="chartContainer" style="max-width: 400px; margin-top: 20px; display: none;">
  <canvas id="healthChart" width="350" height="250" style="border:1px solid #ccc;"></canvas>
</div>

<!-- Gamification Box for score -->
<div class="gamification-box" style="margin-top:20px; font-size: 1.2rem; display:flex; gap: 40px; justify-content: center; align-items: center;">
  <div>
    Health Score: 
    <span class="score-circle" 
          style="font-weight:bold; font-size: 1.2rem; padding: 4px 9px; border-radius: 50%; background-color: #eee; display: inline-block; min-width: 32px; text-align: center;">
      --
    </span>
  </div>
  <div>
    Tier: 
    <span id="tierBadge" class="tier-badge" style="font-weight:bold; font-size: 1.4rem;">
      -- Tier
    </span>
  </div>
</div>

<!-- Save Progress Button -->
<button id="saveProgressBtn" style="margin-top:10px; padding:6px 10px; font-size:0.9rem; cursor:pointer;">
  💾 Save Progress
</button>

<!-- Progress History Section (Compact) -->
<div id="progressHistory" style="margin: 12px 0 10px 0; border: 1px solid #ccc; padding: 8px; border-radius: 6px;">
  <h4 style="margin: 4px 0 8px 0; font-size: 1rem;">📊 Progress History</h4>
  <ul id="historyList" style="list-style-type:none; padding-left:0; font-size: 0.88rem; margin:0;"></ul>
  <button id="clearHistoryBtn" style="margin-top:8px; padding:4px 8px; font-size:0.75rem; cursor:pointer; background:#cc3300; color:white; border:none; border-radius:4px; width: 100%;">
    🗑️ Clear History
  </button>
</div>

<!-- Chart Container for Progress Over Time -->
<canvas id="progressChart" style="margin: 4px 0 10px 0; max-width: 100%; height: 160px; display: block;"></canvas>


<!-- 🔽 Collapsible Estimator Section -->
<div style="margin: 30px auto; max-width: 600px; font-family: Arial, sans-serif;">
  <button onclick="toggleEstimator()" style="width: 100%; padding: 12px; font-size: 1rem; border-radius: 8px; border: 1px solid #007bff; background-color: #f0f8ff; color: #007bff; cursor: pointer;">
    🧮 Smart Daily Calorie & Water Estimator ⌄
  </button>

  <div id="estimatorSection" style="display: none; margin-top: 15px; padding: 16px; border: 1px solid #ccc; border-radius: 10px; background: #f9f9f9;">
    <h3 style="text-align: center; margin-bottom: 16px;">🧮 Daily Estimator</h3>

    <div style="display: flex; flex-direction: column; gap: 12px;">
      <label>Age:
        <input type="number" id="cwe_age" placeholder="e.g., 30" style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
      </label>

      <label>Gender:
        <select id="cwe_gender" style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
          <option value="">-- Select --</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </label>

      <label>Weight (kg):
        <input type="number" id="cwe_weight" placeholder="e.g., 70" style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
      </label>

      <label>Height (cm):
        <input type="number" id="cwe_height" placeholder="e.g., 175" style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
      </label>

      <label>Activity Level:
        <select id="cwe_activity" style="width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
          <option value="">-- Select --</option>
          <option value="1.2">Sedentary (little to no exercise)</option>
          <option value="1.375">Lightly active (1–3 days/week)</option>
          <option value="1.55">Moderately active (3–5 days/week)</option>
          <option value="1.725">Very active (6–7 days/week)</option>
          <option value="1.9">Extra active (hard training)</option>
        </select>
      </label>

      <button onclick="calculateCalorieWater()" style="padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;">
        🔍 Estimate Now
      </button>

     <button onclick="clearCWEInputs()" style="margin-top: 10px; padding: 8px 12px; background-color: #888; color: white; border: none; border-radius: 6px; cursor: pointer;">
    🧹 Clear Inputs
  </button>
    </div>
</div>

    <div id="cwe_result" style="margin-top: 16px; font-size: 1rem; display: none; background: #eef9f1; padding: 12px; border-radius: 8px; border-left: 4px solid #4caf50;">
      <strong>Estimated Needs:</strong><br>
      🔥 Calories/day: <span id="cwe_calories"></span><br>
      💧 Water/day: <span id="cwe_water"></span>
    </div>
  </div>
</div>

<!-- 🏥 Health Metrics Section -->
<!-- 🔖 Common Health Metrics Heading with Buttons -->
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-top: 0.1rem;">

  <h2 style="margin: 0; font-size: 0.90rem;">📊 Common Health Metrics</h2>

  <div style="display: flex; gap: 5px; align-items: center; flex-wrap: wrap;">
    <!-- 🔁 Switch View Button -->
    <button id="toggleViewBtn"
      onclick="toggleHealthView()"
      style="
        padding: 5px 8px;
        font-size: 0.75rem;
        border-radius: 6px;
        background-color: #0077cc;
        color: white;
        border: none;
        cursor: pointer;">
      🔄 Switch View to Card View
    </button>

    <!-- 🔄 Reset All Button with helper text -->

<!-- 🔄 Reset All Button with close descriptive text and arrow -->
<div style="text-align: center; margin-top: 8px;">
  <button id="resetAllBtn"
    onclick="resetAll()"
    title="Clear all health data & results"
    style="
      padding: 5px 8px;
      font-size: 0.75rem;
      border-radius: 6px;
      background-color: #cc3300;
      color: white;
      border: none;
      cursor: pointer;">
    ♻️ Reset All
  </button>
  <div style="font-size: 0.75rem; color: #555; margin-top: 0px; line-height: 1; display: inline-flex; align-items: center; gap: 4px; user-select: none;">
    <span style="font-weight: bold;">&lt;-</span>
    <span><b>Click to reset all data</b></span>
  </div>
</div>

    <!-- ✅ Calculate Health Score Button -->
    <button id="calculateBtn"
      onclick="updateHealthStatus()"
      title="Evaluate current health inputs"
      style="
        padding: 5px 8px;
        font-size: 0.75rem;
        border-radius: 6px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;">
      ✅ Calculate Health Score
    </button>
  </div>
</div>

<!-- 📊 TABLE VIEW -->
<div class="card" id="healthTableView" style="grid-column: 1 / -1; padding: 0; overflow-x: auto;">
  <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem; min-width: 700px;">
    <thead style="background-color: #0077cc; color: white;">
      <tr>
        <th style="padding: 10px; text-align: left;">Parameter</th>
        <th style="padding: 10px; text-align: left;">Standard</th>
        <th style="padding: 10px; text-align: left;">Alert Threshold</th>
        <th style="padding: 10px; text-align: left;">Tip</th>
        <th style="padding: 10px; text-align: left;">Input</th>
        <th style="padding: 10px; text-align: left;">Status</th>
      </tr>
    </thead>
    <tbody>
      <tr style="background: #e0f7fa;">
        <td data-label="Parameter">🩺 Blood Pressure</td>
        <td data-label="Standard">120/80 mmHg</td>
        <td data-label="Threshold" style="color: #ff9800;">&gt;130/90 mmHg</td>
        <td data-label="Tip">Reduce salt, manage stress</td>
        <td data-label="Input"><input type="text" class="user-input" data-param="bloodPressure" placeholder="e.g. 120/80" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #e8f5e9;">
        <td data-label="Parameter">🍬 Blood Sugar (Fasting)</td>
        <td data-label="Standard">80–100 mg/dL</td>
        <td data-label="Threshold" style="color: #e53935;">&gt;110 mg/dL</td>
        <td data-label="Tip">Cut sweets, test regularly</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="bloodSugarFasting" placeholder="e.g. 90" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #e6ffe6;">
        <td data-label="Parameter">🍭 Blood Sugar (Post-Meal)</td>
        <td data-label="Standard">&lt;140 mg/dL</td>
        <td data-label="Threshold" style="color: #e53935;">&gt;180 mg/dL</td>
        <td data-label="Tip">Avoid high-GI food, walk post meals</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="bloodSugarPostMeal" placeholder="e.g. 130" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #fff3e0;">
        <td data-label="Parameter">🥗 Cholesterol (Total)</td>
        <td data-label="Standard">&lt;200 mg/dL</td>
        <td data-label="Threshold" style="color: #f44336;">&gt;240 mg/dL</td>
        <td data-label="Tip">More fiber, less fried food</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="cholesterol" placeholder="e.g. 190" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #fce4ec;">
        <td data-label="Parameter">⚖️ Body Mass Index (BMI)</td>
        <td data-label="Standard">18.5–24.9</td>
        <td data-label="Threshold" style="color: #ef6c00;">Under 18.5 or Over 25</td>
        <td data-label="Tip">Track weight, stay active</td>
        <td data-label="Input"><input type="number" step="0.1" class="user-input" data-param="bmi" placeholder="e.g. 22" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #ede7f6;">
        <td data-label="Parameter">💓 Resting Heart Rate</td>
        <td data-label="Standard">60–100 bpm</td>
        <td data-label="Threshold" style="color: #ff5722;">&lt;50 or &gt;100 bpm</td>
        <td data-label="Tip">Hydrate, reduce caffeine</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="restingHeartRate" placeholder="e.g. 72" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #e1f5fe;">
        <td data-label="Parameter">🌬️ SpO₂ (Oxygen Level)</td>
        <td data-label="Standard">95%–100%</td>
        <td data-label="Threshold" style="color: #d32f2f;">Below 94%</td>
        <td data-label="Tip">Seek help if persistently low</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="spo2" placeholder="e.g. 98" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #fff8e1;">
        <td data-label="Parameter">💤 Sleep Duration</td>
        <td data-label="Standard">7–9 hours/night</td>
        <td data-label="Threshold" style="color: #f57f17;">Less than 6 hours/night</td>
        <td data-label="Tip">Maintain regular schedule, avoid screens before bed</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="sleepDuration" placeholder="e.g. 8" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #f3e5f5;">
        <td data-label="Parameter">📏 Waist Circumference</td>
        <td data-label="Standard">&lt;35 in (women), &lt;40 in (men)</td>
        <td data-label="Threshold" style="color: #d32f2f;">Above these values</td>
        <td data-label="Tip">Watch diet, increase activity</td>
        <td data-label="Input"><input type="number" class="user-input" data-param="waistCircumference" placeholder="e.g. 36" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #fffde7;">
        <td data-label="Parameter">🧂 Sodium</td>
        <td data-label="Standard">135–145 mEq/L</td>
        <td data-label="Threshold" style="color: #f57f17;">&lt;135 or &gt;145 mEq/L</td>
        <td data-label="Tip">Balance salt intake, avoid processed foods</td>
        <td data-label="Input"><input type="number" step="0.1" class="user-input" data-param="sodium" placeholder="e.g. 140" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #e0f2f1;">
        <td data-label="Parameter">🥔 Potassium</td>
        <td data-label="Standard">3.5–5.0 mEq/L</td>
        <td data-label="Threshold" style="color: #d32f2f;">&lt;3.5 or &gt;5.0 mEq/L</td>
        <td data-label="Tip">Eat potassium-rich foods (bananas, spinach), monitor if on meds</td>
        <td data-label="Input"><input type="number" step="0.1" class="user-input" data-param="potassium" placeholder="e.g. 4.5" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
      <tr style="background: #fff3e0;">
        <td data-label="Parameter">🧪 Creatinine</td>
        <td data-label="Standard">0.6–1.3 mg/dL</td>
        <td data-label="Threshold" style="color: #f44336;">&gt;1.3 mg/dL</td>
        <td data-label="Tip">Stay hydrated, monitor kidney health</td>
        <td data-label="Input"><input type="number" step="0.1" class="user-input" data-param="creatinine" placeholder="e.g. 1.0" style="width: 100px;"></td>
        <td data-label="Status" class="status-cell"></td>
      </tr>
    </tbody>
  </table>
</div>

  <div id="summaryStats" style="margin: 10px 0; font-weight: 500;"></div>
  <button id="toggleSavedDataBtn" style="margin:10px 0;">Show Saved Data</button>
  <pre id="savedDataDisplay" style="background:#f0f0f0; padding:10px; max-height: 200px; overflow-y: auto; white-space: pre-wrap; border: 1px solid #ccc; display:none;">      </pre>

<div id="summaryDashboard" style="margin-top: 20px;"></div>

</div>

<!-- 📱 CARD VIEW (Initially hidden) -->
<div id="healthCardView" style="display: none;">
  <div class="card" style="background: #e0f7fa;">
    <h2>🩺 Blood Pressure</h2>
    <p><strong>Standard:</strong> 120/80 mmHg</p>
    <p style="color: #ff9800;"><strong>Alert:</strong> >130/90 mmHg</p>
    <p>💡 Tip: Reduce salt, manage stress</p>
  </div>

  <div class="card" style="background: #e8f5e9;">
    <h2>🍬 Blood Sugar (Fasting)</h2>
    <p><strong>Standard:</strong> 80–100 mg/dL</p>
    <p style="color: #e53935;"><strong>Alert:</strong> >110 mg/dL</p>
    <p>💡 Tip: Cut sweets, test regularly</p>
  </div>

  <div class="card" style="background: #e6ffe6;">
    <h2>🍭 Blood Sugar (Post-Meal)</h2>
    <p><strong>Standard:</strong> &lt;140 mg/dL</p>
    <p style="color: #e53935;"><strong>Alert:</strong> >180 mg/dL</p>
    <p>💡 Tip: Avoid high-GI foods, walk after meals</p>
  </div>

  <div class="card" style="background: #fff3e0;">
    <h2>🥗 Cholesterol (Total)</h2>
    <p><strong>Standard:</strong> &lt;200 mg/dL</p>
    <p style="color: #f44336;"><strong>Alert:</strong> >240 mg/dL</p>
    <p>💡 Tip: Avoid fried food, eat fiber</p>
  </div>

  <div class="card" style="background: #fce4ec;">
    <h2>⚖️ Body Mass Index (BMI)</h2>
    <p><strong>Standard:</strong> 18.5–24.9</p>
    <p style="color: #ef6c00;"><strong>Alert:</strong> Under 18.5 or Over 25</p>
    <p>💡 Tip: Track weight, stay active</p>
  </div>

  <div class="card" style="background: #ede7f6;">
    <h2>💓 Resting Heart Rate</h2>
    <p><strong>Standard:</strong> 60–100 bpm</p>
    <p style="color: #ff5722;"><strong>Alert:</strong> Below 50 or Above 100</p>
    <p>💡 Tip: Hydrate, reduce caffeine</p>
  </div>

  <div class="card" style="background: #e1f5fe;">
    <h2>🌬️ SpO₂ (Oxygen Level)</h2>
    <p><strong>Standard:</strong> 95%–100%</p>
    <p style="color: #d32f2f;"><strong>Alert:</strong> Below 94%</p>
    <p>💡 Tip: Seek help if persistently low</p>
  </div>
  <div class="card" style="background: #fff8e1;">
  <h2>💤 Sleep Duration</h2>
  <p><strong>Standard:</strong> 7–9 hours/night</p>
  <p style="color: #f57f17;"><strong>Alert:</strong> Less than 6 hours/night</p>
  <p>💡 Tip: Maintain regular schedule, avoid screens before bed</p>
</div>

<div class="card" style="background: #f3e5f5;">
  <h2>📏 Waist Circumference</h2>
  <p><strong>Standard:</strong> &lt;35 in (women), &lt;40 in (men)</p>
  <p style="color: #d32f2f;"><strong>Alert:</strong> Above these values</p>
  <p>💡 Tip: Watch diet, increase activity</p>
</div>
<div class="card" style="background: #fffde7;">
  <h2>🧂 Sodium</h2>
  <p><strong>Standard:</strong> 135–145 mEq/L</p>
  <p style="color: #f57f17;"><strong>Alert:</strong> &lt;135 or &gt;145 mEq/L</p>
  <p>💡 Tip: Balance salt intake, avoid processed foods</p>
</div>

<div class="card" style="background: #e0f2f1;">
  <h2>🥔 Potassium</h2>
  <p><strong>Standard:</strong> 3.5–5.0 mEq/L</p>
  <p style="color: #d32f2f;"><strong>Alert:</strong> &lt;3.5 or &gt;5.0 mEq/L</p>
  <p>💡 Tip: Eat potassium-rich foods ((bananas, spinach), monitor if on meds</p>
</div>

<div class="card" style="background: #fff3e0;">
  <h2>🧪 Creatinine</h2>
  <p><strong>Standard:</strong> 0.6–1.3 mg/dL</p>
  <p style="color: #f44336;"><strong>Alert:</strong> &gt;1.3 mg/dL</p>
  <p>💡 Tip: Stay hydrated, monitor kidney health</p>
</div>

</div>

    <section class="utility-grid">
      <!-- 💰 Tax Estimator (Upgraded) -->
  <div class="card">
  <h2>💰 Tax Estimator (India)</h2>

  <label>Annual Income (₹):</label>
  <input type="number" min="0" id="incomeInput" placeholder="Enter total income" />

  <label>Deductions (₹):</label>
  <input type="number" min="0" id="deductionInput" placeholder="Enter 80C/80D deductions" />

  <label>Age Group:</label>
  <select id="ageGroup">
    <option value="below60">Below 60</option>
    <option value="senior">Senior (60-79)</option>
    <option value="super">Super Senior (80+)</option>
  </select>

  <button onclick="calculateTax()">Calculate Tax</button>
  <div class="result" id="taxResult"></div>
</div>

<!-- 📏📈 Unit Converter + INR to USD -->
<div class="card">
  <h2>📏 Conversions</h2>

  <!-- Unit Converter Section -->
  <h3 style="margin-bottom: 5px;">🧮 Unit Converter</h3>
  <select id="unitType" onchange="updateUnitPlaceholders()">
    <option value="km-miles">KM ↔ Miles</option>
    <option value="kg-lbs">Kg ↔ Lbs</option>
    <option value="c-f">°C ↔ °F</option>
  </select>
  <input type="number" min="0" id="unitInput" placeholder="Enter value" />
  <button onclick="convertUnit()">Convert</button>
  <div class="result" id="unitResult"></div>

  <hr style="margin: 15px 0;" />

  <!-- INR to USD Section -->
  <h3 style="margin-bottom: 5px;">💱 INR → USD</h3>
  <input type="number" min="0" id="inrInput" placeholder="Enter INR" />
  <button onclick="convertINR()">Convert</button>
  <div class="result" id="inrResult"></div>
</div>

<!-- 🛠️ Issue Reporter -->
<div class="card">
  <h2>🛠️ Report an Issue</h2>
  <label for="issueCategory">Category:</label>
  <select id="issueCategory">
    <option value="Water">🚿 Water</option>
    <option value="Electricity">💡 Electricity</option>
    <option value="Cleanliness">🧹 Cleanliness</option>
    <option value="Security">🔒 Security</option>
    <option value="Other">❓ Other</option>
  </select>

  <label for="issueText">Describe the issue:</label>
  <input type="text" id="issueText" placeholder="E.g., Leakage in basement near B-12" />

  <button onclick="submitIssue()">Submit Issue</button>

  <hr style="margin: 10px 0;" />

  <h3>📝 Reported Issues</h3>
  <ul id="issueList" style="padding-left: 1.1rem;"></ul>

</div>

<!-- 📅🎂 Age & Date Tools -->
<div class="card">
  <h2>📅 Date Tools</h2>

  <!-- Age Calculator -->
  <h3 style="margin-bottom: 5px;">🎂 Age Calculator</h3>
  <input type="date" id="dobInput" />
  <button onclick="calculateAge()">Calculate Age</button>
  <div class="result" id="ageResult"></div>

  <hr style="margin: 15px 0;" />

  <!-- Date Difference -->
  <h3 style="margin-bottom: 5px;">🗓️ Date Difference</h3>
  <label>From:</label>
  <input type="date" id="date1Input" />
  <label>To:</label>
  <input type="date" id="date2Input" />
  <button onclick="calculateDateDiff()">Calculate</button>
  <div class="result" id="dateDiffResult"></div>
</div>


<!-- 💡 Tip, Fact & Quote Generator -->
<!-- 💡 Daily Inspiration Generator -->
<div class="card">
  <h2>💡 Daily Inspiration</h2>
  <div class="result" id="comboResult"></div>
  <button onclick="showNextItem()">🔄 Next</button>

  <hr style="margin: 10px 0" />

  <h3>Submit a Tip:</h3>
  <input type="text" id="tipInput" placeholder="Write your own tip..." />
  <button onclick="submitTip()">Submit Tip</button>
</div>


<!-- 🧠 Society Trivia Game -->
<div class="card">
  <h2>🧠 Society Trivia</h2>
  <div id="triviaQuestion">Click "Start" to begin!</div>
  <div id="triviaOptions"></div>
  <button onclick="startTrivia()">Start</button>
  <div class="result" id="triviaResult"></div>
</div>

</section>

<!-- ⬆️ Scroll to Top Button -->
<button id="goTopBtn" onclick="scrollToTop()" title="Go to top">⬆️</button>

</main>

  <script>
  
    // 💰 Tax Estimator
  function calculateTax() {
      const inc = parseFloat(document.getElementById('incomeInput').value) || 0;
      const ded = parseFloat(document.getElementById('deductionInput').value) || 0;
      const age = document.getElementById('ageGroup').value;
      if (inc < 0 || ded < 0) {
        alert('Enter non-negative amounts');
        return;
      }
      let slab = age === 'senior'? 300000 : age === 'super'? 500000 : 250000;
      const net = inc - ded;
      let tax = 0;
      if (net > slab && net <= 500000) tax = (net - slab) * 0.05;
      else if (net <= 1000000) tax = 12500 + (net - 500000) * 0.2;
      else if (net > 1000000) tax = 112500 + (net - 1000000) * 0.3;
      document.getElementById('taxResult').innerText = "₹" + (tax<0?0:tax.toFixed(2));
    }

    // Unit Convert
    function convertUnit() {
      const val = parseFloat(document.getElementById('unitInput').value);
      const type = document.getElementById('unitType').value;
      if (isNaN(val)) {
        document.getElementById('unitResult').innerText = 'Enter a valid number';
        return;
      }
      let res = type === 'km-miles'? `${val} km = ${(val*0.621371).toFixed(2)} miles`
        : type === 'kg-lbs'? `${val} kg = ${(val*2.20462).toFixed(2)} lbs`
        : `${val}°C = ${(val*9/5+32).toFixed(2)}°F`;
      document.getElementById('unitResult').innerText = res;
    }

    function updateUnitPlaceholders() {
      document.getElementById('unitInput').value = '';
      document.getElementById('unitResult').innerText = '';
    }

    // 🎂 Age Calculator
    function calculateAge() {
      const dobv = document.getElementById('dobInput').value;
      if (!dobv) {
        alert('Please choose a birth date');
        return;
      }
      const dob = new Date(dobv), now = new Date();
      let age = now.getFullYear() - dob.getFullYear();
      const m = now.getMonth() - dob.getMonth();
      if (m<0 || (m===0 && now.getDate()<dob.getDate())) age--;
      document.getElementById('ageResult').innerText = "Age: " + age + " years";
    }

    // Date Difference
    function calculateDateDiff() {
      const d1 = document.getElementById('date1Input').value;
      const d2 = document.getElementById('date2Input').value;
      const dt1 = d1? new Date(d1):NaN, dt2 = d2? new Date(d2):NaN;
      if (!d1 || !d2 || isNaN(dt1.getTime()) || isNaN(dt2.getTime())) {
        document.getElementById('dateDiffResult').innerText = 'Enter both valid dates';
        return;
      }
      const diff = Math.abs(dt2 - dt1);
      document.getElementById('dateDiffResult').innerText = Math.floor(diff/(1000*60*60*24)) + " days";
    }

  const defaultTips = [
  "Keep emergency contact numbers for security and maintenance easily accessible.",
  "Switch off common area lights during daytime to save energy.",
  "Regularly inspect and clean drainage systems to prevent waterlogging.",
  "Report any damaged sidewalks or community facilities promptly.",
  "Avoid parking in fire lanes to keep access clear for emergency vehicles.",
  "Participate in community clean-up drives to keep the neighborhood pleasant.",
  "Use water-efficient fixtures to reduce communal water consumption.",
  "Notify the committee about unauthorized construction or renovations."
];

const defaultFacts = [
  "Properly maintained green spaces can increase property values by up to 15%.",
  "Energy-efficient LED lighting can reduce electricity use by up to 80%.",
  "Timely maintenance of plumbing reduces water wastage and costly repairs.",
  "Community security initiatives have been shown to reduce theft by 30%.",
  "Regular pest control in shared spaces prevents widespread infestations.",
  "Installing rainwater harvesting systems can cut outdoor water use by 50%.",
  "Shared solar power systems are becoming popular in housing societies to lower electricity bills.",
  "Noise pollution can significantly impact residents’ wellbeing and property values."
];


const defaultQuotes = [
  "“Alone we can do so little; together we can do so much.” — Helen Keller",
  "“The best way to find yourself is to lose yourself in the service of others.” — Gandhi",
  "“Community is much more than belonging to something; it’s about doing something together.” — Unknown",
  "“Coming together is a beginning, staying together is progress, and working together is success.” — Henry Ford",
  "“A journey of a thousand miles begins with a single step.” — Lao Tzu",
  "“The strength of the team is each individual member. The strength of each member is the team.” — Phil Jackson",
  "“It takes a village to raise a child, and a community to build a home.” — Unknown",
  "“Great things in business are never done by one person; they’re done by a team of people.” — Steve Jobs",
  "“In every community, there is work to be done. In every nation, there are wounds to heal.” — Marian Wright Edelman",
  "“We cannot live only for ourselves. A thousand fibers connect us with our fellow men.” — Herman Melville",
  "“Shared joy is a double joy; shared sorrow is half a sorrow.” — Swedish Proverb",
  "“Unity is strength... when there is teamwork and collaboration, wonderful things can be achieved.” — Mattie Stepanek"
];

const paramNames = {
  bloodPressure: "Blood Pressure",
  bloodSugarFasting: "Blood Sugar (Fasting)",
  bloodSugarPostMeal: "Blood Sugar (Post-Meal)",
  cholesterol: "Cholesterol",
  bmi: "Body Mass Index (BMI)",
  restingHeartRate: "Resting Heart Rate",
  spo2: "SpO₂ (Oxygen Level)",
  sleepDuration: "Sleep Duration",
  waistCircumference: "Waist Circumference",
  sodium: "Sodium",
  potassium: "Potassium",
  creatinine: "Creatinine",
};


// Helper functions
function getLocalArray(key, fallback) {
  const stored = localStorage.getItem(key);
  return stored ? JSON.parse(stored) : fallback;
}

function getRandomFromArray(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// Arrays and labels for rotation
const comboArrays = [
  () => getLocalArray("customTips", defaultTips),
  () => defaultQuotes,
  () => defaultFacts,
];

const comboLabels = ["Tip", "Quote", "Fact"];

// Current combo index, saved in localStorage
let comboIndex = parseInt(localStorage.getItem("comboIndex")) || 0;

// Show next item in the rotation
function showNextItem() {
  comboIndex = (comboIndex + 1) % comboArrays.length;
  localStorage.setItem("comboIndex", comboIndex);

  const currentArray = comboArrays[comboIndex]();
  const label = comboLabels[comboIndex];
  const text = getRandomFromArray(currentArray);

  const display = document.getElementById("comboResult");
  display.innerText = `${label}: ${text}`;
}

// Submit new tip
function submitTip() {
  const newTip = document.getElementById("tipInput").value.trim();
  if (!newTip) return alert("Please enter a tip.");

  const tips = getLocalArray("customTips", defaultTips);
  tips.push(newTip);
  localStorage.setItem("customTips", JSON.stringify(tips));

  document.getElementById("tipInput").value = "";
  alert("Tip submitted!");

  // If currently showing Tip, refresh to show new tip
  if (comboIndex === 0) showNextItem();
}

// On page load, show last shown or a random one
window.addEventListener("DOMContentLoaded", () => {
  const currentArray = comboArrays[comboIndex]();
  const label = comboLabels[comboIndex];
  const text = getRandomFromArray(currentArray);

  const display = document.getElementById("comboResult");
  display.innerText = `${label}: ${text}`;
});

function convertINR() {
  const input = document.getElementById('inrInput');
  const val = parseFloat(input.value);

  if (isNaN(val) || val <= 0) {
    alert('Please enter a valid positive amount in INR');
    input.value = ''; // Clear the textbox
    return;
  }

  const out = document.getElementById('inrResult');
  out.innerText = '⚡ Fetching...';

  fetch('https://open.er-api.com/v6/latest/INR')
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(j => {
      const rate = j.rates?.USD;
      if (!rate) throw 0;
      out.innerText = `₹${val} = $${(val * rate).toFixed(2)} (₹1 = $${rate.toFixed(4)})`;
    })
    .catch(_ => {
      out.innerText = '⚠️ Failed to fetch exchange rate';
    });
}

// 🛠️ Issue Reporter Logic
function submitIssue() {
  const text = document.getElementById("issueText").value.trim();
  const category = document.getElementById("issueCategory").value;
  if (!text) return alert("Please enter a description.");

  const issues = JSON.parse(localStorage.getItem("issues") || "[]");

  const newIssue = {
    text,
    category,
    date: new Date().toLocaleString()
  };

  issues.unshift(newIssue); // Add to top
  localStorage.setItem("issues", JSON.stringify(issues.slice(0, 10))); // Keep only last 10
  document.getElementById("issueText").value = "";
  loadIssues();
}

function loadIssues() {
  const issues = JSON.parse(localStorage.getItem("issues") || "[]");
  const list = document.getElementById("issueList");
  list.innerHTML = "";

  if (issues.length === 0) {
    list.innerHTML = "<li style='color: gray;'>No issues reported yet.</li>";
    return;
  }

  issues.forEach(issue => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>[${issue.category}]</strong> ${issue.text}<br/><small>${issue.date}</small>`;
    list.appendChild(li);
  });
}

// Load on startup
window.addEventListener("DOMContentLoaded", loadIssues);

// ⬆️ Scroll to Top Button Logic
const goTopBtn = document.getElementById("goTopBtn");

window.onscroll = function () {
  if (document.body.scrollTop > 150 || document.documentElement.scrollTop > 150) {
    goTopBtn.style.display = "block";
  } else {
    goTopBtn.style.display = "none";
  }
};

function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

const triviaQuestions = [
  {
    question: "How many flats are there in Type A?",
    options: ["24", "30", "64", "40"],
    answer: "64"
  },
  {
    question: "When was the society established?",
    options: ["2005", "2010", "2015", "2020"],
    answer: "2005"
  },
  {
    question: "How many total towers are there in our housing complex",
    options: ["10", "12", "13", "15"],
    answer: "13"
  },
  {
    question: "Which tower is the tallest?",
    options: ["Tower 1D", "Tower E", "Tower 2D", "Tower 3C"],
    answer: "Tower E"
  }
];

let currentTriviaIndex = 0;

function startTrivia() {
  if (currentTriviaIndex >= triviaQuestions.length) {
    document.getElementById("triviaQuestion").innerText = "🎉 You've completed the quiz!";
    document.getElementById("triviaOptions").innerHTML = "";
    return;
  }

  const currentQ = triviaQuestions[currentTriviaIndex];
  document.getElementById("triviaQuestion").innerText = currentQ.question;

  const optionsHTML = currentQ.options.map(option => {
    return `<button onclick="checkTriviaAnswer('${option}')">${option}</button>`;
  }).join("<br>");

  document.getElementById("triviaOptions").innerHTML = optionsHTML;
  document.getElementById("triviaResult").innerText = "";
}

function checkTriviaAnswer(selected) {
  const correct = triviaQuestions[currentTriviaIndex].answer;
  if (selected === correct) {
    document.getElementById("triviaResult").innerText = "✅ Correct!";
  } else {
    document.getElementById("triviaResult").innerText = `❌ Incorrect. Correct answer: ${correct}`;
  }

  currentTriviaIndex++;
  setTimeout(startTrivia, 1500); // Move to next question after 1.5s
}

// 🔄 Toggle between Health Table and Card View
function toggleHealthView() {
  const table = document.getElementById("healthTableView");
  const cards = document.getElementById("healthCardView");
  const btn = document.getElementById("toggleViewBtn");

  const isTableVisible = table.style.display !== "none";

  table.style.display = isTableVisible ? "none" : "block";
  cards.style.display = isTableVisible ? "grid" : "none";

  // Optional: match grid style for card container
  if (isTableVisible) {
    cards.style.gridTemplateColumns = "repeat(auto-fit, minmax(300px, 1fr))";
    cards.style.gap = "20px";
  }

  btn.innerText = isTableVisible ? "🔄 Switch to Table View" : "🔄 Switch to Card View";
}

function resetAll() {
  if (!confirm("Are you sure you want to reset all data?")) return;

  // Clear all input fields (text, number, date)
  document.querySelectorAll('input').forEach(input => {
    if (['number', 'text', 'date'].includes(input.type)) {
      input.value = '';
    }
    input.style.borderColor = ''; // reset input border
  });

  // Reset status cells (badges)
  document.querySelectorAll('.status-cell').forEach(cell => {
    cell.innerHTML = '';
    cell.style.color = 'inherit';
  });

  // Reset select dropdowns (if any)
  document.querySelectorAll('select').forEach(select => {
    select.selectedIndex = 0;
  });

  // Clear all result boxes (if any)
  document.querySelectorAll('.result').forEach(result => {
    result.innerText = '';
  });

  // Clear dashboard score circle and badge
  const scoreCircle = document.querySelector('.score-circle');
  const badge = document.querySelector('.badge');
  if (scoreCircle) scoreCircle.innerText = '--';
  if (badge) badge.innerText = '';

  // Clear dashboard summary (mini stats)
  const summaryContainer = document.getElementById('dashboardSummary');
  if (summaryContainer) summaryContainer.innerHTML = '';

  // Clear the progress bars dashboard
  const progressContainer = document.getElementById('summaryDashboard');
  if (progressContainer) {
    progressContainer.innerHTML = '';
    progressContainer.style.display = 'none'; // optional: hide
  }

  // Clear health chart (if present)
  if (window.healthChartInstance) {
    window.healthChartInstance.destroy();
    window.healthChartInstance = null;
  }

  const chartContainer = document.getElementById('chartContainer');
  if (chartContainer) {
    chartContainer.style.display = 'none';
  }

  // Clear localStorage data used by this app
  localStorage.removeItem('issues');
  localStorage.removeItem('customTips');
  localStorage.removeItem('comboIndex');
  localStorage.removeItem('healthInputs'); // saved user inputs

  // Reload any other dynamic content (inspiration, tips, etc.)
  if (typeof loadIssues === 'function') loadIssues();
  if (typeof showNextItem === 'function') showNextItem();

  //Reset filters
  document.getElementById('summaryFilterContainer').style.display = 'none';

  // Reset summary stats
const summaryDiv = document.getElementById('summaryStats');
if (summaryDiv) {
  summaryDiv.innerHTML =
    `🔢 <strong>Entered:</strong> 0 &nbsp;&nbsp; ✅ <strong>Normal:</strong> 0 &nbsp;&nbsp; ⚠️ <strong>Alerts:</strong> 0 &nbsp;&nbsp; 🕳️ <strong>Missing:</strong> 0`;
   summaryDiv.style.display = 'none'; // 🔒 hide the container
}
  alert("✅ All data and results have been reset.");
}

</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const saved = JSON.parse(localStorage.getItem('healthInputs') || '{}');
  for (const [param, val] of Object.entries(saved)) {
    const input = document.querySelector(`[data-param="${param}"]`);
    if (input) {
      input.value = val;
    }
  }

  // Immediately update health status after restoring
  updateHealthStatus();
});

const thresholds = {
  bloodPressure: val => {
    if (!val) return false;
    const parts = val.split('/').map(x => parseInt(x.trim()));
    if (parts.length !== 2 || parts.some(isNaN)) return false;
    const [sys, dia] = parts;
    return sys > 130 || dia > 90;
  },
  bloodSugarFasting: val => val && Number(val) > 110,
  bloodSugarPostMeal: val => val && Number(val) > 180,
  cholesterol: val => val && Number(val) > 240,
  bmi: val => val && (Number(val) < 18.5 || Number(val) > 25),
  restingHeartRate: val => val && (Number(val) < 50 || Number(val) > 100),
  spo2: val => val && Number(val) < 94,
  sleepDuration: val => val && Number(val) < 6,
  waistCircumference: val => val && Number(val) > 40,
  sodium: val => val && (Number(val) < 135 || Number(val) > 145),
  potassium: val => val && (Number(val) < 3.5 || Number(val) > 5.0),
  creatinine: val => val && Number(val) > 1.3,
};

const paramWeights = {
  bloodPressure: 10,
  bloodSugarFasting: 10,
  bloodSugarPostMeal: 10,
  cholesterol: 7,
  bmi: 6,
  restingHeartRate: 6,
  spo2: 8,
  sleepDuration: 5,
  waistCircumference: 5,
  sodium: 4,
  potassium: 4,
  creatinine: 5,
};

function updateHealthStatus() {
  const inputs = document.querySelectorAll('#healthTableView .user-input');

  // 🛑 Skip calculation if all inputs are empty
  const hasAnyInput = Array.from(inputs).some(input => input.value.trim() !== '');
  if (!hasAnyInput) {
    // Clear the score display
    const scoreCircle = document.querySelector('.score-circle');
    const tierBadge = document.getElementById('tierBadge');
    if (scoreCircle) {
      scoreCircle.innerText = '--';
      scoreCircle.style.backgroundColor = '#eee';  // reset bg color
      scoreCircle.style.color = 'black';           // reset text color
    }
    if (tierBadge) {
      tierBadge.innerText = '-- Tier';
      tierBadge.style.color = 'black';
    }
    return;
  }

  let totalWeight = 0;
  let deductedWeight = 0;
  const affectedParams = [];
  const paramValues = {};

  inputs.forEach(input => {
    const val = input.value.trim();
    const param = input.dataset.param;
    const statusCell = input.closest('tr').querySelector('.status-cell');

    const isAlert = thresholds[param] ? thresholds[param](val) : false;
    const weight = paramWeights[param] || 1;
    totalWeight += weight;

    paramValues[param] = val === '' ? null : val;

    if (val === '') {
      statusCell.innerHTML = '<span class="badge neutral">⚪ Not Entered</span>';
      statusCell.style.color = '#ff9800';
      input.style.borderColor = ''; // reset
    } else if (isAlert) {
      statusCell.innerHTML = '<span class="badge alert">⚠️ Alert</span>';
      statusCell.style.color = 'red';
      deductedWeight += weight;
      affectedParams.push(param);
      input.style.borderColor = 'red';
    } else {
      statusCell.innerHTML = '<span class="badge ok">✅ Normal</span>';
      statusCell.style.color = 'green';
      input.style.borderColor = 'green';
    }
  });

  const score = totalWeight === 0 ? 0 : Math.round(((totalWeight - deductedWeight) / totalWeight) * 100);

  // Determine tier based on score
  let tier = 'Bronze';
  if (score >= 90) tier = 'Gold';
  else if (score >= 75) tier = 'Silver';

  // Update Health Score and Tier with color and circle background
  const scoreCircle = document.querySelector('.score-circle');
  const tierBadge = document.getElementById('tierBadge');

  if (scoreCircle) {
    scoreCircle.innerText = score;

    // Color circle bg and text based on tier
    switch (tier.toLowerCase()) {
      case 'gold':
        scoreCircle.style.backgroundColor = 'goldenrod';
        scoreCircle.style.color = 'black';
        break;
      case 'silver':
        scoreCircle.style.backgroundColor = 'silver';
        scoreCircle.style.color = 'black';
        break;
      case 'bronze':
        scoreCircle.style.backgroundColor = '#cd7f32'; // bronze
        scoreCircle.style.color = 'white';
        break;
      default:
        scoreCircle.style.backgroundColor = '#eee';
        scoreCircle.style.color = 'black';
    }
  }

  if (tierBadge) {
    tierBadge.innerText = `${tier} Tier`;
    switch (tier.toLowerCase()) {
      case 'gold':
        tierBadge.style.color = 'goldenrod';
        break;
      case 'silver':
        tierBadge.style.color = 'silver';
        break;
      case 'bronze':
        tierBadge.style.color = '#cd7f32'; // bronze
        break;
      default:
        tierBadge.style.color = 'black';
    }
  }

  renderDashboardSummaryFromTable(affectedParams);
  renderHealthChart(affectedParams, paramValues);

  // 🔄 Save all inputs to localStorage
  localStorage.setItem('healthInputs', JSON.stringify(paramValues));

  let entered = 0, normal = 0, alert = 0, missing = 0;

  inputs.forEach(input => {
    const val = input.value.trim();
    const statusCell = input.closest('tr').querySelector('.status-cell');

    if (val === '') {
      missing++;
    } else {
      entered++;
      if (statusCell.innerHTML.includes('alert')) {
        alert++;
      } else {
        normal++;
      }
    }
  });

  const summaryDiv = document.getElementById('summaryStats');
  if (summaryDiv) {
    summaryDiv.innerHTML =
      `🔢 <strong>Entered:</strong> ${entered} &nbsp;&nbsp; ✅ <strong>Normal:</strong> ${normal} &nbsp;&nbsp; ⚠️ <strong>Alerts:</strong> ${alert} &nbsp;&nbsp; 🕳️ <strong>Missing:</strong> ${missing}`;
    summaryDiv.style.display = 'block'; // 👁️ make it visible again
  }

  updateSummaryDashboard(paramValues, affectedParams);
}

// Chart instance
  let healthChartInstance = null;

  // Render dashboard summary cards with optional affected param highlights
  function renderDashboardSummaryFromTable(affected = []) {
    const summaryContainer = document.getElementById('dashboardSummary');
    if (!summaryContainer) return;
    summaryContainer.innerHTML = '';

    const filterButtons = document.querySelectorAll('.filter-btn');
    let selectedFilter = 'all';
    filterButtons.forEach(btn => {
      if (btn.classList.contains('active')) selectedFilter = btn.dataset.filter;
    });

    const tableRows = document.querySelectorAll('#healthTableView tbody tr');
    let visibleCardCount = 0;

    tableRows.forEach(row => {
      const input = row.querySelector('input.user-input');
      const param = input?.dataset.param || '';
      const parameter = row.querySelectorAll('td')[0]?.innerText || 'Unknown';
      const statusCell = row.querySelector('.status-cell');
      const statusText = statusCell ? statusCell.innerText : 'Status Unknown';
      const statusColor = statusCell ? statusCell.style.color : 'inherit';

      let cardBg = '#f5f5f5';
      let statusType = 'neutral';

      if (statusText.includes('✅')) {
        cardBg = '#e8f5e9';
        statusType = 'normal';
      } else if (statusText.includes('⚠️')) {
        cardBg = '#ffebee';
        statusType = 'alert';
      } else if (statusText.includes('⚪')) {
        cardBg = '#fffde7';
        statusType = 'neutral';
      }

      if (selectedFilter !== 'all' && selectedFilter !== statusType) {
        return;
      }

      const dsCard = document.createElement('div');
      dsCard.className = 'ds-card';
      dsCard.style.border = affected.includes(param) ? '2px solid red' : '1px solid #ccc';
      dsCard.style.padding = '8px';
      dsCard.style.marginBottom = '8px';
      dsCard.style.borderRadius = '6px';
      dsCard.style.backgroundColor = cardBg;

      dsCard.innerHTML = `
        <h4 style="margin-top: 0;">${parameter}</h4>
        <p style="color: ${statusColor}; margin: 0;">${statusText}</p>
      `;

      summaryContainer.appendChild(dsCard);
      visibleCardCount++;
    });

    // Show/hide filter container based on visible cards
    const filterContainer = document.getElementById('summaryFilterContainer');
    if (filterContainer) {
      filterContainer.style.display = visibleCardCount > 0 ? 'flex' : 'none';
    }
  }

  // Render Chart using Chart.js with affectedParams highlighting
  function renderHealthChart(affectedParams, paramValues) {
    const chartContainer = document.getElementById('chartContainer');
    const canvas = document.getElementById('healthChart');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');

    // Filter labels according to paramValues (only those with a value)
    const labels = Object.keys(paramValues).filter(param => paramValues[param] !== null && paramValues[param] !== '');
    if (labels.length === 0) {
      if (chartContainer) chartContainer.style.display = 'none';
      return;
    }
    if (chartContainer) chartContainer.style.display = 'block';

    // Prepare chart data values
    const data = labels.map(param => {
      const val = paramValues[param];
      if (typeof val === 'string' && val.includes('/')) {
        const parts = val.split('/').map(x => parseInt(x.trim()));
        return parts[0] || 0;
      }
      return Number(val) || 0;
    });

    // Color bars red for affected params, teal for others
    const backgroundColors = labels.map(param =>
      affectedParams.includes(param)
        ? 'rgba(255, 99, 132, 0.8)'
        : 'rgba(75, 192, 192, 0.8)'
    );

    // Destroy old chart instance if exists
    if (healthChartInstance) healthChartInstance.destroy();

    canvas.height = labels.length * 30;

    healthChartInstance = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Input Values',
          data,
          backgroundColor: backgroundColors,
          barThickness: 12,
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: { display: false },
            beginAtZero: true,
            ticks: { precision: 0 },
            max: Math.max(...data) * 1.2 || 100,
          },
          y: {
            grid: { display: false },
            ticks: { font: { size: 14 }, autoSkip: false },
            categoryPercentage: 0.95,
            barPercentage: 0.95,
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: ctx => `${ctx.parsed.x}` } }
        }
      }
    });
  }

  // Collect filtered data based on active filter button
  function getFilteredParamData() {
    const paramValues = {};
    const affectedParams = [];
    const filterButtons = document.querySelectorAll('.filter-btn');
    let selectedFilter = 'all';

    filterButtons.forEach(btn => {
      if (btn.classList.contains('active')) selectedFilter = btn.dataset.filter;
    });

    const rows = document.querySelectorAll('#healthTableView tbody tr');
    rows.forEach(row => {
      const input = row.querySelector('input.user-input');
      const param = input?.dataset.param || '';
      const valRaw = input?.value || '';

      const statusCell = row.querySelector('.status-cell');
      const statusText = statusCell ? statusCell.innerText : '';
      let statusType = 'neutral';
      if (statusText.includes('✅')) statusType = 'normal';
      else if (statusText.includes('⚠️')) statusType = 'alert';
      else if (statusText.includes('⚪')) statusType = 'neutral';

      // Skip if filter does not match
      if (selectedFilter !== 'all' && selectedFilter !== statusType) return;

      paramValues[param] = valRaw;
      if (statusType === 'alert') affectedParams.push(param);
    });

    return { paramValues, affectedParams };
  }

  // This function is called when filter changes
  function onFilterChange() {
    const { paramValues, affectedParams } = getFilteredParamData();
    renderDashboardSummaryFromTable(affectedParams);
    renderHealthChart(affectedParams, paramValues);
  }

  // Setup filter buttons event listeners
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      onFilterChange();
    };
  });


const toggleBtn = document.getElementById('toggleSavedDataBtn');
const displayArea = document.getElementById('savedDataDisplay');

if(toggleBtn){
  toggleBtn.addEventListener('click', () => {
    if (displayArea.style.display === 'none' || displayArea.style.display === '') {
      const savedData = localStorage.getItem('healthInputs');
      if (savedData) {
        try {
          const obj = JSON.parse(savedData);
          displayArea.textContent = JSON.stringify(obj, null, 2);
        } catch (e) {
          displayArea.textContent = "Error parsing saved data.";
        }
      } else {
        displayArea.textContent = "No saved data found.";
      }
      displayArea.style.display = 'block';
      toggleBtn.textContent = 'Hide Saved Data';
    } else {
      displayArea.style.display = 'none';
      toggleBtn.textContent = 'Show Saved Data';
    }
  });
}

window.addEventListener('DOMContentLoaded', () => {
  // Clear all inputs in the healthTableView on page load
  document.querySelectorAll('#healthTableView .user-input').forEach(input => {
    input.value = '';
    input.style.borderColor = '';
  });

  // Clear stored health inputs from localStorage
  localStorage.removeItem('healthInputs');

  // Reset score display
  const scoreCircle = document.querySelector('.score-circle');
  const tierBadge = document.getElementById('tierBadge');
  if (scoreCircle) scoreCircle.innerText = '--';
  if (tierBadge) tierBadge.innerText = '-- Tier';

  // Reset and hide summary stats container
  const summaryDiv = document.getElementById('summaryStats');
  if (summaryDiv) {
    summaryDiv.innerHTML = '';
    summaryDiv.style.display = 'none';
  }
});


// Helper: Get saved progress history from localStorage
  function getProgressHistory() {
    return JSON.parse(localStorage.getItem('healthProgressHistory') || '[]');
  }

  // Helper: Save progress history array to localStorage
  function saveProgressHistory(history) {
    localStorage.setItem('healthProgressHistory', JSON.stringify(history));
  }

  // Render progress history list in UI with delete buttons
  function renderProgressHistory() {
    const history = getProgressHistory();
    const list = document.getElementById('historyList');
    if (!list) return;

    list.innerHTML = ''; // clear

    if (history.length === 0) {
      list.innerHTML = '<li style="color:#666; padding: 6px 0;">No progress saved yet.</li>';
      return;
    }

    history.forEach((entry, index) => {
      const li = document.createElement('li');
      li.style = "display:flex; justify-content: space-between; align-items: center; padding: 4px 0; border-bottom: 1px solid #eee;";
      const date = new Date(entry.timestamp);
      const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

      li.innerHTML = `
        <span>📅 <strong>${dateStr}</strong> — Health Score: <strong>${entry.score}</strong> (${entry.tier} Tier)</span>
        <button aria-label="Delete this progress entry" data-index="${index}" style="background:none; border:none; color:#cc3300; font-weight:bold; cursor:pointer; font-size:1.1rem;">✖</button>
      `;

      // Delete button event
      li.querySelector('button').addEventListener('click', () => {
        if (confirm('Delete this progress entry?')) {
          const hist = getProgressHistory();
          hist.splice(index, 1);
          saveProgressHistory(hist);
          renderProgressHistory();
          renderProgressChart();
        }
      });

      list.appendChild(li);
    });
  }

  // Render line chart for progress history (requires Chart.js)
  function renderProgressChart() {
    const history = getProgressHistory();
    const ctx = document.getElementById('progressChart')?.getContext('2d');
    if (!ctx) return;

    if (window.progressChartInstance) {
      window.progressChartInstance.destroy();
    }

    if (history.length === 0) {
      document.getElementById('progressChart').style.display = 'none';
      return;
    }

    document.getElementById('progressChart').style.display = 'block';

    // Sort by timestamp ascending
    history.sort((a, b) => a.timestamp - b.timestamp);

    const labels = history.map(entry => new Date(entry.timestamp).toLocaleDateString());
    const scores = history.map(entry => entry.score);

    window.progressChartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Health Score',
          data: scores,
          borderColor: 'rgb(75, 192, 192)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          tension: 0.3,
          fill: true,
          pointRadius: 5,
          pointHoverRadius: 7,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            min: 0,
            max: 100,
            ticks: { stepSize: 10 }
          }
        }
      }
    });
  }

//--------------------------------------------------

  // Save current health score progress with timestamp
  function saveCurrentProgress() {
    const scoreText = document.querySelector('.score-circle')?.innerText;
    const tierText = document.getElementById('tierBadge')?.innerText.replace(' Tier', '') || 'Unknown';

    if (!scoreText || scoreText === '--') {
      alert('Please enter health data to generate a score before saving progress.');
      return;
    }

    const score = parseInt(scoreText, 10);
    const timestamp = Date.now();

    const history = getProgressHistory();
    history.push({ timestamp, score, tier: tierText });
    saveProgressHistory(history);

    renderProgressHistory();
    renderProgressChart();
  }

  // Clear saved progress history
  function clearProgressHistory() {
    if (confirm('Are you sure you want to clear all saved progress history?')) {
      localStorage.removeItem('healthProgressHistory');
      renderProgressHistory();
      renderProgressChart();
    }
  }

  // Attach event listeners after DOM loads
  document.addEventListener('DOMContentLoaded', () => {
    renderProgressHistory();
    renderProgressChart();

    const saveBtn = document.getElementById('saveProgressBtn');
    const clearBtn = document.getElementById('clearHistoryBtn');

    if (saveBtn) saveBtn.addEventListener('click', saveCurrentProgress);
    if (clearBtn) clearBtn.addEventListener('click', clearProgressHistory);
  });


function toggleEstimator() {
    const section = document.getElementById('estimatorSection');
    section.style.display = section.style.display === 'none' ? 'block' : 'none';
  }

  function calculateCalorieWater() {
    const age = parseInt(document.getElementById('cwe_age').value);
    const gender = document.getElementById('cwe_gender').value;
    const weight = parseFloat(document.getElementById('cwe_weight').value);
    const height = parseFloat(document.getElementById('cwe_height').value);
    const activityFactor = parseFloat(document.getElementById('cwe_activity').value);

    if (!age || !weight || !height || !activityFactor || !gender) {
      alert("Please fill out all fields.");
      return;
    }

    let bmr;
    if (gender === 'male') {
      bmr = 10 * weight + 6.25 * height - 5 * age + 5;
    } else {
      bmr = 10 * weight + 6.25 * height - 5 * age - 161;
    }

    const calories = Math.round(bmr * activityFactor);
    const waterLiters = (weight * 35) / 1000;

    document.getElementById('cwe_calories').textContent = `${calories} kcal`;
    document.getElementById('cwe_water').textContent = `${waterLiters.toFixed(1)} liters`;

    document.getElementById('cwe_result').style.display = 'block';
  }

// 🧹 Clear Inputs
function clearCWEInputs() {
  ['cwe_age', 'cwe_gender', 'cwe_weight', 'cwe_height', 'cwe_activity'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  document.getElementById('cwe_result').style.display = 'none';
  document.getElementById('cwe_calories').textContent = '';
  document.getElementById('cwe_water').textContent = '';
}

function filterDashboardCards() {
  const filter = document.getElementById('cardFilter').value;
  const cards = document.querySelectorAll('.dashboard-summary .ds-card');

  cards.forEach(card => {
    const text = card.innerText.toLowerCase();
    if (filter === 'all') {
      card.style.display = 'block';
    } else if (filter === 'alert' && text.includes('⚠️')) {
      card.style.display = 'block';
    } else if (filter === 'normal' && text.includes('✅')) {
      card.style.display = 'block';
    } else if (filter === 'neutral' && text.includes('⚪')) {
      card.style.display = 'block';
    } else {
      card.style.display = 'none';
    }
  });
}

</script>

</body>
</html>
