<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minutes of Meetings</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <meta name="description" content="Official page of Avishikta - I Type - A RWA. Stay informed, get involved, and build a stronger association.">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
  <script src="layout-loader.js"></script>
  <style>
    /* Reset and base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Nunito', sans-serif;
      background-color: #f4f4f9;
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 0;
      margin: 0;
      width: 100%;
      flex-direction: column;
    }
    main {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    /* Banner */
    .mom-banner {
      width: 100%;
      height: 180px;
      background-image: url('img-5.jpg');
      background-size: cover;
      background-position: center;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 15px;
    }
    /* Image */
    .mom-banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    /* Text */
    .mom-banner h2 {
      font-size: 1.5rem;
      font-weight: 600;
      background: rgba(0, 0, 0, 0.5);
      padding: 12px 25px;
      border-radius: 8px;
    }
    /* Controls */
    #controls {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    #controls input[type="text"], 
    #controls select {
      padding: 8px 14px;
      font-size: 0.85rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 180px;
      flex-grow: 1;
    }
    #controls button {
      padding: 8px 16px;
      font-size: 0.85rem;
      font-weight: bold;
      border-radius: 6px;
      border: 1px solid #0073e6;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #controls button:hover {
      background: #e6f0ff;
      transform: scale(1.05);
      transition: transform 0.2s ease, background-color 0.3s ease;
    }
    .button-wrapper {
      display: flex;
      gap: 10px;
    }
    .action-btn, .delete-btn {
      position: relative;
      background: #0073e6;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      padding: 8px 14px;
      opacity: 0.9;
      transition: opacity 0.3s ease;
    }
    button[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    button[data-tooltip]:hover::after {
      opacity: 1;
      pointer-events: auto;
    }
    .action-btn:hover, .delete-btn:hover {
      opacity: 1;
      transform: scale(1.05);
    }
    /* MoM list */
    #momList {
      display: flex;
      gap: 15px;
      flex-wrap: nowrap;
      margin-top: 20px;
      overflow-x: auto;
      width: 100%;
    }
    .mom-summary {
      background: #f5f9ff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 20px 25px;  /* increased padding */
      display: block;
      flex-direction: column;
      gap: 8px;
      min-width: 300px;
      max-width: 350px; /* optional: prevent over-expansion */
      overflow-wrap: break-word; /* ensure breaks */
      word-wrap: break-word;
      flex-shrink: 0;
      
    }
    .mom-summary h3 {
      color: #0073e6;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .mom-summary .mom-date {
      font-size: 0.7rem;
      color: #555;
    }
    .mom-summary p {
      font-size: 0.80rem;
      line-height: 1.4;
      color: #333;
      text-align: justify;
      word-wrap: break-word;
      white-space: normal !important; /* important: allows text to wrap */
      margin-bottom: 12px;      /* spacing below paragraphs */
    }
    .mom-summary:hover {
      transform: translateY(-8px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .mom-summary.agm {
      background-color: #e8f9e9; /* Light green */
    }

   .mom-summary.gb {
      background-color: #eef6ff; /* Light blue */
    }
    .mom-summary.ec {
      background-color: #fff4e6; /* Light orange */
    }
    .view-full-btn {
      align-self: flex-start;
      background: #0073e6;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background-color 0.3s ease;
    }
    .view-full-btn:hover {
      background: #005bb5;
    }
    /* Modal */
    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
    }
  #modalOverlay.active {
     display: flex;
  }
    #modalContent {
      width: 100vw;
      max-width: 1200px;
      height: 95vh;
      max-height: 95vh;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      background: white;
    }
    #modalHeader {
      background: #0073e6;
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 1rem;
      flex-shrink: 0;
    }
    #modalCloseBtn {
      background: none;
      border: none;
      font-size: 1.3rem;
      color: white;
      cursor: pointer;
      font-weight: 900;
      padding: 0 10px;
      transition: color 0.3s ease;
    }
    #modalCloseBtn:hover {
      color: #ff6b6b;
    }
    #pdfViewer {
      flex-grow: 1;
      overflow-y: auto;          /* enable vertical scroll */
      overflow-x: hidden;        /* hide horizontal scroll */
      display: block;            /* stack children vertically */
      background: #ededed;
      padding: 15px;
      max-height: 100%;          /* ensure container fits modal */
    }
    #pdfViewer canvas {
      display: block;
      margin-bottom: 20px;
      max-width: 100%;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      border-radius: 8px;
   }

    canvas {
      max-width: 100%;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      border-radius: 8px;
    }
    /* No MoMs found */
    #noMomMessage {
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      color: #666;
      margin-top: 40px;
      width: 100%;
    }
    /* Responsive */
    @media (max-width: 720px) {
      #momList {
        flex-direction: column;
        overflow-x: visible;
      }
      .mom-summary {
        max-width: 100%;
        min-width: 100%;
      }
      #controls {
        flex-direction: column;
        gap: 12px;
      }
      #controls input[type="text"], #controls select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <section class="mom-banner" aria-label="Banner showing Minutes of Meeting image and title">
      <h2>Minutes of Meetings (MoM) — <br> Official records of Avishikta - I Type - A RWA meetings</h2>
    </section>

    <section id="controls" aria-label="Filter and search controls for Minutes of Meetings">
      <input type="text" id="searchInput" placeholder="Search by text, date, or type" aria-label="Search Minutes of Meetings" />
      <select id="typeFilter" aria-label="Filter by meeting type">
        <option value="all">All Types</option>
        <option value="agm">Annual General Meeting</option>
        <option value="gb">General Body Meeting</option>
        <option value="ec">Executive Committee Meeting</option>
        <option value="apex">Appex Committee Meeting</option>
      </select>
      <select id="yearFilter" aria-label="Filter by year">
        <option value="all">All Years</option>
        <!-- JavaScript will populate years here -->
      </select>
      <div class="button-wrapper">
        <button id="clearFilters" aria-label="Clear all filters and search">Clear</button>
      </div>
    </section>

    <section id="momList" aria-live="polite" aria-relevant="additions removals" aria-label="List of Minutes of Meetings">
      <!-- Dynamically loaded MoM summaries -->
    </section>

    <div id="noMomMessage" role="alert" aria-live="assertive" style="display:none;">
      No matching minutes of meetings found.
    </div>
  </main>

  <div id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div id="modalContent">
      <div id="modalHeader">
        <span id="modalTitle">Viewing PDF</span>
        <button id="modalCloseBtn" aria-label="Close PDF viewer">&times;</button>
      </div>
      <div id="pdfViewer" tabindex="0" aria-label="PDF document viewer"></div>
    </div>
  </div>

<script>
  const moms = [
    {
  id: "01",
  name: "Apex Meeting 2025",
  date: "2025-09-07",
  summary: "Main and back gate repair and painting to be completed by Nov 30, coordinated by Niloy, pro-rata distribution of common collections among all associations, coordinated by Niloy, fire pump room repairs to start post-Puja, quotations to be validated by Siddhartha and Abhijit, STP area to be cleared of bushes and garbage, letter to be issued with councillor in CC, drafted by Niloy, fire license renewal treated as top priority, Abhijit to coordinate work, Chiranjib to validate before online application, possession of shops from Bengal Peerless approved with corridor access planned, legal consultation on proposed Type–A extension to be initiated by Niloy, payment approved for community hall glass repair, Niloy to follow up, revised water charge of ₹500 per event effective Nov 1, payable to Type–B Association, repair and repainting of discoloured statues unanimously approved, MyGate to replace NoBrokerHood as digital partner, Subhadeep to issue notice, second gate to be opened intermittently based on operational feasibility, urgent termite treatment required for community hall due to infestation, relocation of obstructing electrical poles to be explored for better parking access.",
  type: "APEX",
  file: "downloads/mom_2025-09-07-apex.pdf"
}
,
    {
      id: "02",
      name: "19th AGM 2025",
      date: "2025-07-27",
      summary: "Financial status was delivered via projector, A new website for the association was officially unveiled by Senior Member Mr. S. K. Roy, The unveiling ceremony was followed by a heartfelt recognition of the designer and developer behind the site, Niloy Pandit, the Secretary, whose exceptional vision and dedication played a pivotal role in bringing the website to life, It was unanimously resolved that members with monthly maintenance dues for 3 or more consecutive months will temporarily be deprived of maintenance-oriented services until the due amount is cleared. Furthermore, the names of defaulters will be displayed across all communication channels.",
      type: "AGM",
      file: "downloads/mom-2025-07-27-19thagm.pdf"
    },
    {
      id: "03",
      name: "GBM 2024",
      date: "2024-12-22",
      summary: "The Monthly Maintenance Charge was discussed and unanimously approved for an increment of Rs. 150.00, effective from April 1, 2025, Revision of Discount Structure for One-Time Payment of MMC April 1 2025, Facilitating Common Area Capital Expenditures, To shorten the official name of the Association.",
      type: "GB",
      file: "downloads/mom-2024-12-22-gb.pdf"
    }
  ];

  // Convert type to lowercase for consistent filtering keys (agm, gb, ec)
  moms.forEach(mom => {
    mom.type = mom.type.toLowerCase();
  });

  // Cache DOM elements
  const momListEl = document.getElementById('momList');
  const searchInput = document.getElementById('searchInput');
  const typeFilter = document.getElementById('typeFilter');
  const yearFilter = document.getElementById('yearFilter');
  const clearBtn = document.getElementById('clearFilters');
  const noMomMessage = document.getElementById('noMomMessage');
  const modalOverlay = document.getElementById('modalOverlay');
  const modalCloseBtn = document.getElementById('modalCloseBtn');
  const pdfViewer = document.getElementById('pdfViewer');
  const modalTitle = document.getElementById('modalTitle');

  // Initialize PDF.js
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.worker.min.js';

  // Populate year filter dynamically from moms
  function populateYearFilter() {
    const years = new Set();
    moms.forEach(mom => {
      const year = mom.date.slice(0,4);
      years.add(year);
    });
    const sortedYears = Array.from(years).sort((a,b) => b - a);
    sortedYears.forEach(year => {
      const option = document.createElement('option');
      option.value = year;
      option.textContent = year;
      yearFilter.appendChild(option);
    });
  }

  // Render MoM summaries filtered by criteria
  function renderMomList() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    const typeVal = typeFilter.value;
    const yearVal = yearFilter.value;

    // Clear existing
    momListEl.innerHTML = '';

    // Filter data
    const filtered = moms.filter(mom => {
      // Filter by type
      if (typeVal !== 'all' && mom.type !== typeVal) return false;
      // Filter by year
      if (yearVal !== 'all' && mom.date.slice(0,4) !== yearVal) return false;
      // Search filter on name, summary, and date (as string)
      if (searchTerm) {
        const combinedText = (mom.name + ' ' + mom.summary + ' ' + mom.date).toLowerCase();
        if (!combinedText.includes(searchTerm)) return false;
      }
      return true;
    });

    if (filtered.length === 0) {
      noMomMessage.style.display = 'block';
      return;
    } else {
      noMomMessage.style.display = 'none';
    }

    filtered.forEach(mom => {
      const div = document.createElement('article');
      div.className = `mom-summary ${mom.type}`;
      div.setAttribute('tabindex', '0');
      div.setAttribute('role', 'region');
      div.setAttribute('aria-label', `Minutes of Meeting: ${mom.name}`);

      const h3 = document.createElement('h3');
      h3.textContent = mom.name;
      div.appendChild(h3);

      const dateP = document.createElement('p');
      dateP.className = 'mom-date';
      dateP.textContent = new Date(mom.date).toLocaleDateString(undefined, {year: 'numeric', month: 'long', day: 'numeric'});
      div.appendChild(dateP);

      const summaryP = document.createElement('p');
      summaryP.textContent = mom.summary.length > 280 ? mom.summary.slice(0, 280) + '...' : mom.summary;
      div.appendChild(summaryP);

      const viewBtn = document.createElement('button');
      viewBtn.textContent = 'View Full Document';
      viewBtn.className = 'view-full-btn';
      viewBtn.setAttribute('aria-label', `View full PDF for ${mom.name}`);
      viewBtn.addEventListener('click', () => openPdfModal(mom.file, mom.name));
      div.appendChild(viewBtn);

      momListEl.appendChild(div);
    });
  }

  // Clear filters
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    typeFilter.value = 'all';
    yearFilter.value = 'all';
    renderMomList();
    searchInput.focus();
  });

  // Attach filter listeners
  [searchInput, typeFilter, yearFilter].forEach(el => {
    el.addEventListener('input', () => {
      renderMomList();
    });
  });

  // Modal close logic
  modalCloseBtn.addEventListener('click', closePdfModal);
  modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closePdfModal();
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
      closePdfModal();
    }
  });

  // Load and render PDF in modal
  async function openPdfModal(pdfUrl, title) {
    modalTitle.textContent = title;
    modalOverlay.classList.add('active');
    pdfViewer.innerHTML = ''; // Clear previous

    try {
      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      const pdf = await loadingTask.promise;

      // Clear viewer
      pdfViewer.innerHTML = '';

      // Render all pages sequentially
      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        const page = await pdf.getPage(pageNum);
        const viewport = page.getViewport({ scale: 1.8 });
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: context, viewport: viewport }).promise;

        pdfViewer.appendChild(canvas);
      }
      pdfViewer.focus();
    } catch (error) {
      pdfViewer.textContent = 'Failed to load PDF.';
      console.error('Error loading PDF:', error);
    }
  }

  function closePdfModal() {
    modalOverlay.classList.remove('active');
    pdfViewer.innerHTML = '';
  }

  // Initialize
  populateYearFilter();
  renderMomList();
</script>
</body>
</html>
