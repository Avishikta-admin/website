<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minutes of Meetings</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <meta name="description" content="Official page of Avishikta - I Type - A RWA. Stay informed, get involved, and build a stronger association.">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
  <!-- Your existing layout.js -->
  <script src="layout-loader.js"></script>

  <style>
    /* Reset and base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Nunito', sans-serif;
      background-color: #f4f4f9;
      color: #333;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 0;
      margin: 0;
      width: 100%;
      flex-direction: column;
    }
    main {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    /* Banner */
    .mom-banner {
      width: 100%;
      height: 180px;
      background-image: url('img-5.jpg');
      background-size: cover;
      background-position: center;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 15px;
    }
    /* Image */
    .mom-banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    /* Text */
    .mom-banner h2 {
      font-size: 1.5rem;
      font-weight: 600;
      background: rgba(0, 0, 0, 0.5);
      padding: 12px 25px;
      border-radius: 8px;
    }
    /* Controls */
    #controls {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    #controls input[type="text"], 
    #controls select {
      padding: 8px 14px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 180px;
      flex-grow: 1;
    }
    #controls button {
      padding: 8px 16px;
      font-size: 0.85rem;
      font-weight: bold;
      border-radius: 6px;
      border: 1px solid #0073e6;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #controls button:hover {
      background: #e6f0ff;
      transform: scale(1.05);
      transition: transform 0.2s ease, background-color 0.3s ease;
    }
    .button-wrapper {
      display: flex;
      gap: 10px;
    }
    .action-btn, .delete-btn {
      position: relative;
      background: #0073e6;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      padding: 8px 14px;
      opacity: 0.9;
      transition: opacity 0.3s ease;
    }
    button[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    button[data-tooltip]:hover::after {
      opacity: 1;
      pointer-events: auto;
    }
    .action-btn:hover, .delete-btn:hover {
      opacity: 1;
      transform: scale(1.05);
    }
    /* MoM list */
    #momList {
      display: flex;
      gap: 15px;
      flex-wrap: nowrap;
      margin-top: 20px;
      overflow-x: auto;
      width: 100%;
    }
    .mom-summary {
      background: #f5f9ff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 20px 25px;  /* increased padding */
      display: block;
      flex-direction: column;
      gap: 8px;
      min-width: 300px;
      max-width: 350px; /* optional: prevent over-expansion */
      overflow-wrap: break-word; /* ensure breaks */
      word-wrap: break-word;
      flex-shrink: 0;
      
    }
    .mom-summary h3 {
      color: #0073e6;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .mom-summary .mom-date {
      font-size: 0.7rem;
      color: #555;
    }
    .mom-summary p {
      font-size: 0.80rem;
      line-height: 1.4;
      color: #333;
      text-align: justify;
      word-wrap: break-word;
      white-space: normal !important; /* important: allows text to wrap */
      margin-bottom: 12px;      /* spacing below paragraphs */
    }
    .mom-summary:hover {
      transform: translateY(-8px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .mom-summary.agm {
      background-color: #e8f9e9; /* Light green */
    }

   .mom-summary.gb {
      background-color: #eef6ff; /* Light blue */
    }
    .mom-summary.ec {
      background-color: #fff4e6; /* Light orange */
    }
    .view-full-btn {
      align-self: flex-start;
      background: #0073e6;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background-color 0.3s ease;
    }
    .view-full-btn:hover {
      background: #005bb5;
    }
    /* Modal */
    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 20px;
    }
  #modalOverlay.active {
     display: flex;
  }
    #modalContent {
      width: 100vw;
      max-width: 1200px;
      height: 95vh;
      max-height: 95vh;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      background: white;
    }
    #modalHeader {
      background: #0073e6;
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 1.1rem;
    }
    #modalCloseBtn {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      line-height: 1;
    }
    #modalBody {
      flex-grow: 1;
      overflow: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }
    #pdfCanvas {
      max-width: 100%;
      max-height: 85vh;
      border: 1px solid #ccc;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #pageControls {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    #pageControls button {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #0073e6;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;
    }
    #pageControls button:disabled {
      background: #ccc;
      border-color: #aaa;
      cursor: default;
    }
    #pageInfo {
      font-weight: 600;
      font-size: 0.95rem;
      color: #333;
    }
    /* Scroll to top */
    #scrollToTop {
      position: fixed;
      bottom: 50px;
      right: 10px;
      width: 40px;
      height: 40px;
      background: #ff6347;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 22px;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 11000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      user-select: none;
    }
    #scrollToTop:hover {
      background: #4b0082;
      animation: bounce 0.5s ease infinite;
    }

  .mom-type-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  font-size: 0.7rem;
  font-weight: bold;
  border-radius: 20px;
  color: white;
  margin-left: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.mom-type-badge i {
  font-size: 0.75rem;
}

.badge-agm { background-color: #2ecc71; }  /* Emerald Green */
.badge-gb { background-color: #2980b9; }   /* Royal Blue */
.badge-ec { background-color: #e67e22; }   /* Warm Orange */

@media (max-width: 500px) {
  #controls {
    flex-direction: column;
    align-items: stretch;
  }
  body {
    font-size: 0.9rem;
  }
  .mom-summary {
    padding: 15px;
    font-size: 0.85rem;
  }

  .view-full-btn {
    width: 100%;
    text-align: center;
  }
  #controls input, 
  #controls select,
  #controls button {
  width: 100%;
  }
}

@media (max-width: 600px) {
  #modalContent {
    width: 100vw;
    height: 100vh;
    max-height: 100vh;
    max-width: 100vw;
    border-radius: 0;
  }
}


</style>
</head>
<body>

<button id="scrollToTop" title="Go to top"><i class="fa fa-chevron-up"></i></button>

<main>
  <section class="mom-banner">
    <h2>Minutes of Meetings</h2>
  </section>

  <section id="controls">
    <input id="searchInput" type="text" placeholder="Search MoMs (case insensitive, partial match)" />
    
    <select id="yearFilter">
      <option value="">All Years</option>
      <!-- dynamically filled -->
    </select>

   <select id="typeFilter">
  <option value="">All Types</option>
  <option value="AGM">AGM</option>
  <option value="GB">GB</option>
  <option value="EC">EC</option>
</select>

<div class="button-wrapper">
      <button id="resetBtn" title="Reset all filters">Reset</button>
    </div>
  </section>

  <section id="momList" aria-live="polite" aria-atomic="true" aria-relevant="additions">
    <!-- MoM summaries rendered here -->
  </section>
</main>

<div id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
  <div id="modalContent">
    <header id="modalHeader">
      <span id="modalTitle">MoM PDF Viewer</span>
      <button id="modalCloseBtn" aria-label="Close modal">&times;</button>
    </header>
    <main id="modalBody">
      <canvas id="pdfCanvas" aria-label="PDF viewer"></canvas>
      <div id="pageControls">
  <button id="prevPage" aria-label="Previous page">Prev</button>
  <span id="pageInfo">Page 1 of 1</span>
  <button id="nextPage" aria-label="Next page">Next</button>

  <label for="zoomSelect" style="margin-left: 10px;">Zoom:</label>
  <select id="zoomSelect" style="padding: 4px 8px; font-size: 0.9rem;">
    <option value="1">100%</option>
    <option value="1.25">125%</option>
    <option value="1.5" selected>150%</option>
    <option value="2">200%</option>
    <option value="2.5">250%</option>
  </select>
</div>

    </main>
  </div>
</div>

<script>
  // MoM data
  const moms = [
    {
      id: "01",
      name: "19th AGM 2025",
      date: "2025-07-27",
      summary: "Annual General Meeting with discussion on community plans and finances.",
      type: "AGM",
      file: "downloads/mom-2025-07-27-19thagm.pdf"
    },
    {
      id: "02",
      name: "GBM 2024",
      date: "2024-12-22",
      summary: "The Monthly Maintenance Charge was discussed and unanimously approved for an increment of Rs. 150.00, effective from April 1, 2025, Revision of Discount Structure for One-Time Payment of MMC April 1 2025, Facilitating Common Area Capital Expenditures, To shorten the official name of the Association.",
      type: "GB",
      file: "downloads/mom-2024-12-22-gb.pdf"
    },
    {
      id: "03",
      name: "ECM 2025",
      date: "2025-06-29",
      summary: "Confirmation of AGM Date, Approval of Salary Advance Requested by Sri. Parameshwar (Bikash) Mondal, Approval to circulate Feedback Form, Approval of developing Association Website, Appointment of Gardener.",
      type: "EC",
      file: "downloads/mom_2025-06-29-ec.pdf"
    },
    {
      id: "04",
      name: "ECM 2025",
      date: "2025-05-25",
      summary: "Presentation of Financial Report, Appointment of Auditor for FY 2024â€“25, Salary Revisions of office executive and electricians, Flat No. 1A-403 sold.",
      type: "EC",
      file: "downloads/mom_2025-05-25-ec.pdf"
    }
  ];

  // Elements
  const momList = document.getElementById('momList');
  const searchInput = document.getElementById('searchInput');
  const yearFilter = document.getElementById('yearFilter');
  const typeFilter = document.getElementById('typeFilter');
  const resetBtn = document.getElementById('resetBtn');
  const modalOverlay = document.getElementById('modalOverlay');
  const modalCloseBtn = document.getElementById('modalCloseBtn');
  const pdfCanvas = document.getElementById('pdfCanvas');
  const prevPageBtn = document.getElementById('prevPage');
  const nextPageBtn = document.getElementById('nextPage');
  const pageInfo = document.getElementById('pageInfo');
  const zoomSelect = document.getElementById('zoomSelect');
let userScale = 1.5; // default zoom

zoomSelect.addEventListener('change', () => {
  userScale = parseFloat(zoomSelect.value);
  renderPage(currentPage);
});


  // PDF.js viewer setup
  const pdfjsLib = window['pdfjs-dist/build/pdf'];
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.worker.min.js';
  
  let pdfDoc = null;
  let currentPage = 1;
  let totalPages = 0;
  const ctx = pdfCanvas.getContext('2d');

  // Populate year filter dynamically
  const years = [...new Set(moms.map(m => new Date(m.date).getFullYear()))].sort((a,b) => b - a);
  years.forEach(year => {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    yearFilter.appendChild(option);
  });

  // Utility: create badge based on type
  function createTypeBadge(type) {
    const badge = document.createElement('span');
    badge.classList.add('mom-type-badge');
    if(type === 'AGM') badge.classList.add('badge-agm');
    else if(type === 'GB') badge.classList.add('badge-gb');
    else if(type === 'EC') badge.classList.add('badge-ec');
    badge.setAttribute('aria-label', `Type: ${type}`);
    let iconHtml = '';
    if(type === 'AGM') iconHtml = '<i class="fa fa-users" aria-hidden="true"></i>';
    else if(type === 'GB') iconHtml = '<i class="fa fa-gavel" aria-hidden="true"></i>';
    else if(type === 'EC') iconHtml = '<i class="fa fa-briefcase" aria-hidden="true"></i>';
    badge.innerHTML = iconHtml + type;
    return badge;
  }

  // Render filtered MoMs list
  function renderMomList() {
    const searchTerm = searchInput.value.trim().toLowerCase();
    const yearVal = yearFilter.value;
    const typeVal = typeFilter.value;

    momList.innerHTML = '';

    const filtered = moms.filter(mom => {
      const matchSearch = mom.name.toLowerCase().includes(searchTerm) || mom.summary.toLowerCase().includes(searchTerm);
      const matchYear = yearVal ? (new Date(mom.date).getFullYear().toString() === yearVal) : true;
      const matchType = typeVal ? mom.type === typeVal : true;
      return matchSearch && matchYear && matchType;
    });

    if(filtered.length === 0) {
      momList.innerHTML = '<p>No meetings found matching criteria.</p>';
      return;
    }

    filtered.forEach(mom => {
      const momDiv = document.createElement('div');
      momDiv.classList.add('mom-summary', mom.type.toLowerCase());

      const h3 = document.createElement('h3');
      h3.textContent = mom.name;
      h3.appendChild(createTypeBadge(mom.type));
      momDiv.appendChild(h3);

      const dateP = document.createElement('p');
      dateP.classList.add('mom-date');
      dateP.textContent = new Date(mom.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
      momDiv.appendChild(dateP);

      const summaryP = document.createElement('p');
      summaryP.textContent = mom.summary;
      momDiv.appendChild(summaryP);

      const viewBtn = document.createElement('button');
      viewBtn.textContent = 'View Full MoM';
      viewBtn.className = 'view-full-btn';
      viewBtn.setAttribute('aria-label', `View full minutes of meeting for ${mom.name}`);
      viewBtn.addEventListener('click', () => openModal(mom.file, mom.name));
      momDiv.appendChild(viewBtn);

      momList.appendChild(momDiv);
    });
  }

  // Load PDF and render page
  async function renderPage(pageNum) {
  if (!pdfDoc) return;

  try {
    const page = await pdfDoc.getPage(pageNum);
    const modalBody = document.getElementById('modalBody');

    // Get available size
    const containerWidth = modalBody.clientWidth;
    const containerHeight = modalBody.clientHeight;

    // Get natural PDF page size
    const unscaledViewport = page.getViewport({ scale: 1 });

    // Calculate best scale that fits both width and height
    const scaleX = containerWidth / unscaledViewport.width;
    const scaleY = containerHeight / unscaledViewport.height;
    const scale = Math.min(scaleX, scaleY) * userScale;

    const viewport = page.getViewport({ scale });

    // Adjust for high DPI (e.g. Retina)
    const outputScale = window.devicePixelRatio || 1;
    const scaledWidth = Math.floor(viewport.width * outputScale);
    const scaledHeight = Math.floor(viewport.height * outputScale);

    pdfCanvas.width = scaledWidth;
    pdfCanvas.height = scaledHeight;
    pdfCanvas.style.width = `${viewport.width}px`;
    pdfCanvas.style.height = `${viewport.height}px`;

    const renderContext = {
      canvasContext: ctx,
      viewport: viewport,
      transform: outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : undefined
    };

    await page.render(renderContext).promise;

    pageInfo.textContent = `Page ${pageNum} of ${pdfDoc.numPages}`;
    prevPageBtn.disabled = pageNum <= 1;
    nextPageBtn.disabled = pageNum >= pdfDoc.numPages;

  } catch (e) {
    console.error("Error rendering page:", e);
  }
}


  // Open modal and load PDF
  async function openModal(pdfFile, title) {
    modalOverlay.classList.add('active');
    modalOverlay.focus();
    document.getElementById('modalTitle').textContent = title;

    currentPage = 1;

    try {
      pdfDoc = await pdfjsLib.getDocument(pdfFile).promise;
      totalPages = pdfDoc.numPages;
      await renderPage(currentPage);
    } catch (error) {
      console.error("Error loading PDF:", error);
      pdfCanvas.style.display = 'none';
      pageInfo.textContent = 'Failed to load PDF';
      prevPageBtn.disabled = true;
      nextPageBtn.disabled = true;
    }
  }

  // Close modal
  function closeModal() {
    modalOverlay.classList.remove('active');
    pdfDoc = null;
    ctx.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
  }

  // Navigation buttons handlers
  prevPageBtn.addEventListener('click', () => {
    if (currentPage <= 1) return;
    currentPage--;
    renderPage(currentPage);
  });
  nextPageBtn.addEventListener('click', () => {
    if (currentPage >= totalPages) return;
    currentPage++;
    renderPage(currentPage);
  });

  modalCloseBtn.addEventListener('click', closeModal);

  // Close modal on overlay click (only if clicking outside modalContent)
  modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closeModal();
  });

  // Keyboard support: Escape key closes modal
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
      closeModal();
    }
  });

  // Filter handlers
  searchInput.addEventListener('input', renderMomList);
  yearFilter.addEventListener('change', renderMomList);
  typeFilter.addEventListener('change', renderMomList);

  // Reset filters
  resetBtn.addEventListener('click', () => {
    searchInput.value = '';
    yearFilter.value = '';
    typeFilter.value = '';
    renderMomList();
  });

  // Scroll to top button
  const scrollToTopBtn = document.getElementById('scrollToTop');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      scrollToTopBtn.style.display = 'flex';
    } else {
      scrollToTopBtn.style.display = 'none';
    }
  });
  scrollToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });


  // Initial render
  renderMomList();
</script>

</body>
</html>
